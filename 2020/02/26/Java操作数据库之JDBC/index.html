<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">



<title>Java操作数据库之JDBC | Allen Xue&#39;s Blog</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


</head>
<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">Allen Xue&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>

        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">Allen Xue&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
        <div class="main">
            <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">Java操作数据库之JDBC</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">Allen Xue</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">February 26, 2020&nbsp;&nbsp;23:02:10</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/category/JavaWeb/">JavaWeb</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <h2 id="一、JDBC"><a href="#一、JDBC" class="headerlink" title="一、JDBC"></a>一、JDBC</h2><h3 id="1、概念"><a href="#1、概念" class="headerlink" title="1、概念"></a>1、概念</h3><p><strong>Java DataBase Connectivity  Java 数据库连接， Java语言操作数据库</strong></p>
<ul>
<li><strong>JDBC本质</strong>：其实是官方（<strong>sun公司</strong>）定义的<strong>一套操作所有关系型数据库的规则，即接口</strong>。各个数据库厂商去实现这套接口，提供数据库驱动jar包。我们可以使用这套接口（JDBC）编程，真正执行的代码是驱动jar包中的实现类。<br><img src="/2020/02/26/Java操作数据库之JDBC/1.png" alt="image"></li>
</ul>
<h3 id="2、快速入门"><a href="#2、快速入门" class="headerlink" title="2、快速入门"></a>2、快速入门</h3><ul>
<li><p><strong>步骤</strong>：</p>
<pre><code>1. 导入驱动jar包 mysql-connector-java-5.1.37-bin.jar
    * 复制mysql-connector-java-5.1.37-bin.jar到项目的libs目录下
    * 右键--&gt;Add As Library
2. 注册驱动
3. 获取数据库连接对象 Connection
4. 定义sql
5. 获取执行sql语句的对象 Statement
6. 执行sql，接受返回结果
7. 处理结果
8. 释放资源</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">* 代码实现：</span><br><span class="line">  	//1. 导入驱动jar包</span><br><span class="line">    //2.注册驱动</span><br><span class="line">    Class.forName(&quot;com.mysql.jdbc.Driver&quot;);</span><br><span class="line">    //3.获取数据库连接对象</span><br><span class="line">    Connection conn = DriverManager.getConnection(&quot;jdbc:mysql://localhost:3306/db3&quot;, &quot;root&quot;, &quot;root&quot;);</span><br><span class="line">    //4.定义sql语句</span><br><span class="line">    String sql = &quot;update account set balance = 500 where id = 1&quot;;</span><br><span class="line">    //5.获取执行sql的对象 Statement</span><br><span class="line">    Statement stmt = conn.createStatement();</span><br><span class="line">    //6.执行sql</span><br><span class="line">    int count = stmt.executeUpdate(sql);</span><br><span class="line">    //7.处理结果</span><br><span class="line">    System.out.println(count);</span><br><span class="line">    //8.释放资源</span><br><span class="line">    stmt.close();</span><br><span class="line">    conn.close();</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>如果是MySQL8.0版本的配置请参考<a href="https://blog.csdn.net/qq_34504626/article/details/104526679" target="_blank" rel="noopener">这篇文章</a></p>
<h3 id="3、详解各个对象"><a href="#3、详解各个对象" class="headerlink" title="3、详解各个对象"></a>3、详解各个对象</h3><h5 id="（1）DriverManager：驱动管理对象"><a href="#（1）DriverManager：驱动管理对象" class="headerlink" title="（1）DriverManager：驱动管理对象"></a>（1）DriverManager：驱动管理对象</h5><ul>
<li><p>功能：</p>
<ul>
<li><p><strong>注册驱动</strong>：告诉程序该使用哪一个数据库驱动jar</p>
<ul>
<li><p><code>static void registerDriver(Driver driver)</code> :<strong>注册与给定的驱动程序 DriverManager 。</strong> </p>
</li>
<li><p><strong>写代码使用</strong>：  <code>Class.forName(&quot;com.mysql.jdbc.Driver&quot;);</code></p>
</li>
<li><p>通过查看源码发现：<strong>在com.mysql.jdbc.Driver类中存在静态代码块</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">static &#123;</span><br><span class="line">       try &#123;</span><br><span class="line">           java.sql.DriverManager.registerDriver(new Driver());</span><br><span class="line">       &#125; catch (SQLException E) &#123;</span><br><span class="line">           throw new RuntimeException(&quot;Can&apos;t register driver!&quot;);</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>注意：mysql5之后的驱动jar包可以省略注册驱动的步骤。*</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>获取数据库连接：</p>
<ul>
<li>方法：<code>static Connection getConnection(String url, String user, String password)</code></li>
<li>参数：<ul>
<li><code>url</code>：指定连接的路径<ul>
<li>语法：<code>jdbc:mysql://ip地址(域名):端口号/数据库名称</code></li>
<li>例子：<code>jdbc:mysql://localhost:3306/db3</code></li>
<li>细节：<strong>如果连接的是本机mysql服务器，并且mysql服务默认端口是3306，则url可以简写为</strong>：<code>jdbc:mysql:///数据库名称</code></li>
</ul>
</li>
<li><code>user</code>：用户名</li>
<li><code>password</code>：密码 </li>
</ul>
</li>
</ul>
</li>
</ul>
<p><em>如果是MySQL8.0版本的配置请参考<a href="https://blog.csdn.net/qq_34504626/article/details/104526679" target="_blank" rel="noopener">这篇文章</a></em></p>
<h4 id="（2）Connection：数据库连接对象"><a href="#（2）Connection：数据库连接对象" class="headerlink" title="（2）Connection：数据库连接对象"></a>（2）Connection：数据库连接对象</h4><ul>
<li>功能：<ul>
<li><strong>获取执行sql的对象</strong><ul>
<li><code>Statement createStatement()</code></li>
<li><code>PreparedStatement prepareStatement(String sql)</code></li>
</ul>
</li>
<li><strong>管理事务</strong>：<ul>
<li><strong>开启事务</strong>：<code>setAutoCommit(boolean autoCommit)</code> ：调用该方法<strong>设置参数为false，即开启事务</strong></li>
<li><strong>提交事务</strong>：<code>commit()</code></li>
<li><strong>回滚事务</strong>：<code>rollback()</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="（3）Statement：执行sql的对象"><a href="#（3）Statement：执行sql的对象" class="headerlink" title="（3）Statement：执行sql的对象"></a>（3）Statement：执行sql的对象</h4><ul>
<li><p>执行sql:</p>
<ul>
<li><code>boolean execute(String sql)</code> ：<strong>可以执行任意的sql</strong> (了解) </li>
<li><code>int executeUpdate(String sql)</code> ：<strong>执行DML（insert、update、delete）语句、DDL(create，alter、drop)语句</strong><ul>
<li><strong>返回值</strong>：<strong>影响的行数</strong>，可以通过这个影响的行数判断DML语句是否执行成功， <strong>返回值&gt;0的则执行成功，反之，则失败。</strong></li>
</ul>
</li>
<li><code>ResultSet executeQuery(String sql)</code> ：<strong>执行DQL（select)语句</strong></li>
</ul>
</li>
<li><p>练习：</p>
<ul>
<li><p>account表 添加一条记录</p>
</li>
<li><p>account表 修改记录</p>
</li>
<li><p>account表 删除一条记录</p>
<p>代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">Statement stmt = null;</span><br><span class="line">      Connection conn = null;</span><br><span class="line">      try &#123;</span><br><span class="line">          //1. 注册驱动</span><br><span class="line">          Class.forName(&quot;com.mysql.jdbc.Driver&quot;);</span><br><span class="line">          //2. 定义sql</span><br><span class="line">          String sql = &quot;insert into account values(null,&apos;王五&apos;,3000)&quot;;</span><br><span class="line">          //3.获取Connection对象</span><br><span class="line">          conn = DriverManager.getConnection(&quot;jdbc:mysql:///db3&quot;, &quot;root&quot;, &quot;root&quot;);</span><br><span class="line">          //4.获取执行sql的对象 Statement</span><br><span class="line">          stmt = conn.createStatement();</span><br><span class="line">          //5.执行sql</span><br><span class="line">          int count = stmt.executeUpdate(sql);//影响的行数</span><br><span class="line">          //6.处理结果</span><br><span class="line">          System.out.println(count);</span><br><span class="line">          if(count &gt; 0)&#123;</span><br><span class="line">              System.out.println(&quot;添加成功！&quot;);</span><br><span class="line">          &#125;else&#123;</span><br><span class="line">              System.out.println(&quot;添加失败！&quot;);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">      &#125; catch (ClassNotFoundException e) &#123;</span><br><span class="line">          e.printStackTrace();</span><br><span class="line">      &#125; catch (SQLException e) &#123;</span><br><span class="line">          e.printStackTrace();</span><br><span class="line">      &#125;finally &#123;</span><br><span class="line">          //stmt.close();</span><br><span class="line">          //7. 释放资源</span><br><span class="line">          //避免空指针异常</span><br><span class="line">          if(stmt != null)&#123;</span><br><span class="line">              try &#123;</span><br><span class="line">                  stmt.close();</span><br><span class="line">              &#125; catch (SQLException e) &#123;</span><br><span class="line">                  e.printStackTrace();</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          if(conn != null)&#123;</span><br><span class="line">              try &#123;</span><br><span class="line">                  conn.close();</span><br><span class="line">              &#125; catch (SQLException e) &#123;</span><br><span class="line">                  e.printStackTrace();</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h4 id="（4）ResultSet：结果集对象-封装查询结果"><a href="#（4）ResultSet：结果集对象-封装查询结果" class="headerlink" title="（4）ResultSet：结果集对象,封装查询结果"></a>（4）ResultSet：结果集对象,封装查询结果</h4><ul>
<li><p><code>boolean next()</code>: <strong>游标向下移动一行，判断当前行是否是最后一行末尾(是否有数据)，如果是，则返回false，如果不是则返回true</strong></p>
</li>
<li><p><code>getXxx(参数)</code>:<strong>获取数据</strong></p>
<ul>
<li><code>Xxx</code>：<strong>代表数据类型</strong>   如： <code>int getInt()</code> ,    <code>String getString()</code></li>
<li><strong>参数</strong>：<ul>
<li><code>int</code>：<strong>代表列的编号,从1开始。</strong>   如： <code>getString(1)</code></li>
<li><code>String</code>：<strong>代表列名称</strong>。 如： <code>getDouble(&quot;balance&quot;)</code></li>
</ul>
</li>
</ul>
</li>
<li><p>注意：</p>
<ul>
<li>使用步骤：<ul>
<li>游标向下移动一行</li>
<li>判断是否有数据</li>
<li>获取数据<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//循环判断游标是否是最后一行末尾。</span><br><span class="line">while(rs.next())&#123;</span><br><span class="line">    //获取数据</span><br><span class="line">    int id = rs.getInt(1);</span><br><span class="line">    String name = rs.getString(&quot;name&quot;);</span><br><span class="line">    double balance = rs.getDouble(3);</span><br><span class="line"></span><br><span class="line">    System.out.println(id + &quot;---&quot; + name + &quot;---&quot; + balance);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li><p>练习：</p>
<ul>
<li><em>定义一个方法，查询emp表的数据将其封装为对象，然后装载集合，返回</em>。<ul>
<li>定义Emp类</li>
<li>定义方法 public List<emp> findAll(){}</emp></li>
<li>实现方法 select * from emp;</li>
</ul>
</li>
</ul>
</li>
<li><p>代码实现：<br><br>Emp类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">package com.allen.domain;</span><br><span class="line"></span><br><span class="line">import java.util.Date;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 封装Emp表数据的JavaBean</span><br><span class="line"> */</span><br><span class="line">public class Emp &#123;</span><br><span class="line">    private int id;</span><br><span class="line">    private String ename;</span><br><span class="line">    private int job_id;</span><br><span class="line">    private int mgr;</span><br><span class="line">    private Date joindate;</span><br><span class="line">    private double salary;</span><br><span class="line">    private double bonus;</span><br><span class="line">    private int dept_id;</span><br><span class="line"></span><br><span class="line">    public double getBonus() &#123;</span><br><span class="line">        return bonus;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setBonus(double bonus) &#123;</span><br><span class="line">        this.bonus = bonus;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getId() &#123;</span><br><span class="line">        return id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setId(int id) &#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getEname() &#123;</span><br><span class="line">        return ename;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setEname(String ename) &#123;</span><br><span class="line">        this.ename = ename;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getJob_id() &#123;</span><br><span class="line">        return job_id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setJob_id(int job_id) &#123;</span><br><span class="line">        this.job_id = job_id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getMgr() &#123;</span><br><span class="line">        return mgr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setMgr(int mgr) &#123;</span><br><span class="line">        this.mgr = mgr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Date getJoindate() &#123;</span><br><span class="line">        return joindate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setJoindate(Date joindate) &#123;</span><br><span class="line">        this.joindate = joindate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public double getSalary() &#123;</span><br><span class="line">        return salary;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSalary(double salary) &#123;</span><br><span class="line">        this.salary = salary;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getDept_id() &#123;</span><br><span class="line">        return dept_id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setDept_id(int dept_id) &#123;</span><br><span class="line">        this.dept_id = dept_id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;Emp&#123;&quot; +</span><br><span class="line">                &quot;id=&quot; + id +</span><br><span class="line">                &quot;, ename=&apos;&quot; + ename + &apos;\&apos;&apos; +</span><br><span class="line">                &quot;, job_id=&quot; + job_id +</span><br><span class="line">                &quot;, mgr=&quot; + mgr +</span><br><span class="line">                &quot;, joindate=&quot; + joindate +</span><br><span class="line">                &quot;, salary=&quot; + salary +</span><br><span class="line">                &quot;, bonus=&quot; + bonus +</span><br><span class="line">                &quot;, dept_id=&quot; + dept_id +</span><br><span class="line">                &apos;&#125;&apos;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>查询所有：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">import com.allen.domain.Emp;</span><br><span class="line">import java.sql.*;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * * 定义一个方法，查询emp表的数据将其封装为对象，然后装载集合，返回。</span><br><span class="line"> */</span><br><span class="line">public class JdbcDemo8 &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        List&lt;Emp&gt; list = new JdbcDemo8().findAll2();</span><br><span class="line">        System.out.println(list);</span><br><span class="line">        System.out.println(list.size());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 查询所有emp对象</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public List&lt;Emp&gt; findAll() &#123;</span><br><span class="line">        Connection conn = null;</span><br><span class="line">        Statement stm = null;</span><br><span class="line">        ResultSet rs = null;</span><br><span class="line">        List&lt;Emp&gt; list = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            Class.forName(&quot;com.mysql.cj.jdbc.Driver&quot;);</span><br><span class="line">            conn = DriverManager.getConnection(&quot;jdbc:mysql:///jdbc?useSSL=false&amp;serverTimezone=UTC&quot;, &quot;root&quot;, &quot;991104&quot;);</span><br><span class="line">            stm = conn.createStatement();</span><br><span class="line">            String sql = &quot;select * from emp&quot;;</span><br><span class="line">            rs = stm.executeQuery(sql);</span><br><span class="line">            Emp emp = null;</span><br><span class="line">            list = new ArrayList&lt;Emp&gt;();</span><br><span class="line">            while (rs.next()) &#123;</span><br><span class="line">                int id = rs.getInt(&quot;id&quot;);</span><br><span class="line">                String ename = rs.getString(&quot;ename&quot;);</span><br><span class="line">                int job_id = rs.getInt(&quot;job_id&quot;);</span><br><span class="line">                int mgr = rs.getInt(&quot;mgr&quot;);</span><br><span class="line">                Date joindate = rs.getDate(&quot;joindate&quot;);</span><br><span class="line">                double salary = rs.getDouble(&quot;salary&quot;);</span><br><span class="line">                double bonus = rs.getDouble(&quot;bonus&quot;);</span><br><span class="line">                int dept_id = rs.getInt(&quot;dept_id&quot;);</span><br><span class="line">                //创建emp对象,并赋值</span><br><span class="line">                emp = new Emp();</span><br><span class="line">                emp.setId(id);</span><br><span class="line">                emp.setEname(ename);</span><br><span class="line">                emp.setJob_id(job_id);</span><br><span class="line">                emp.setMgr(mgr);</span><br><span class="line">                emp.setJoindate(joindate);</span><br><span class="line">                emp.setSalary(salary);</span><br><span class="line">                emp.setBonus(bonus);</span><br><span class="line">                emp.setDept_id(dept_id);</span><br><span class="line"></span><br><span class="line">                //装载集合</span><br><span class="line">                list.add(emp);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            if (rs != null) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    rs.close();</span><br><span class="line">                &#125; catch (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            if (stm != null) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    stm.close();</span><br><span class="line">                &#125; catch (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            if (conn != null) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    conn.close();</span><br><span class="line">                &#125; catch (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return list;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="（5）PreparedStatement：执行sql的对象"><a href="#（5）PreparedStatement：执行sql的对象" class="headerlink" title="（5）PreparedStatement：执行sql的对象"></a>（5）PreparedStatement：执行sql的对象</h4><ul>
<li><p><strong>SQL注入问题</strong>：<strong>在拼接sql时，有一些sql的特殊关键字参与字符串的拼接。会造成安全性问题</strong></p>
<ul>
<li>输入用户随便，输入密码：a’ or ‘a’ = ‘a</li>
<li>sql：select * from user where username = ‘fhdsjkf’ and password = ‘a’ or ‘a’ = ‘a’ </li>
</ul>
</li>
<li><p>解决sql注入问题：使<strong>用PreparedStatement对象来解决</strong></p>
</li>
<li><p>预编译的SQL：<strong>参数使用?作为占位符</strong></p>
</li>
<li><p>步骤：</p>
<pre><code>1. 导入驱动jar包 mysql-connector-java-5.1.37-bin.jar
2. 注册驱动
3. 获取数据库连接对象 Connection
4. 定义sql
    * 注意：sql的参数使用？作为占位符。 如：select * from user where username = ? and password = ?;
5. 获取执行sql语句的对象 PreparedStatement  Connection.prepareStatement(String sql) 
6. 给？赋值：
    * 方法： setXxx(参数1,参数2)
        * 参数1：？的位置编号 从1 开始
        * 参数2：？的值
7. 执行sql，接受返回结果，不需要传递sql语句
8. 处理结果
9. 释放资源</code></pre></li>
<li><p>注意：使用PreparedStatement来完成增删改查的所有操作</p>
<ul>
<li><strong>可以防止SQL注入</strong></li>
<li><strong>效率更高</strong></li>
</ul>
</li>
</ul>
<h2 id="二、抽取JDBC工具类：JDBCUtils"><a href="#二、抽取JDBC工具类：JDBCUtils" class="headerlink" title="二、抽取JDBC工具类：JDBCUtils"></a>二、抽取JDBC工具类：JDBCUtils</h2><ul>
<li><p><strong>目的</strong>：简化书写</p>
</li>
<li><p><strong>分析</strong>：</p>
<pre><code>1、注册驱动也抽取
2、抽取一个方法获取连接对象
    * 需求：不想传递参数（麻烦），还得保证工具类的通用性。
    * 解决：配置文件
        jdbc.properties
            url=
            user=
            password=
3、抽取一个方法释放资源</code></pre></li>
</ul>
<ul>
<li><p>代码实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">public class JDBCUtils &#123;</span><br><span class="line">    private static String url;</span><br><span class="line">    private static String user;</span><br><span class="line">    private static String password;</span><br><span class="line">    private static String driver;</span><br><span class="line">    /**</span><br><span class="line">     * 文件的读取，只需要读取一次即可拿到这些值。使用静态代码块</span><br><span class="line">     */</span><br><span class="line">    static&#123;</span><br><span class="line">        //读取资源文件，获取值。</span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line">            //1. 创建Properties集合类。</span><br><span class="line">            Properties pro = new Properties();</span><br><span class="line"></span><br><span class="line">            //获取src路径下的文件的方式---&gt;ClassLoader 类加载器</span><br><span class="line">            ClassLoader classLoader = JDBCUtils.class.getClassLoader();</span><br><span class="line">            URL res  = classLoader.getResource(&quot;jdbc.properties&quot;);</span><br><span class="line">            String path = res.getPath();</span><br><span class="line">            System.out.println(path);///D:/IdeaProjects/itcast/out/production/day04_jdbc/jdbc.properties</span><br><span class="line">            //2. 加载文件</span><br><span class="line">           // pro.load(new FileReader(&quot;D:\\IdeaProjects\\itcast\\day04_jdbc\\src\\jdbc.properties&quot;));</span><br><span class="line">            pro.load(new FileReader(path));</span><br><span class="line"></span><br><span class="line">            //3. 获取数据，赋值</span><br><span class="line">            url = pro.getProperty(&quot;url&quot;);</span><br><span class="line">            user = pro.getProperty(&quot;user&quot;);</span><br><span class="line">            password = pro.getProperty(&quot;password&quot;);</span><br><span class="line">            driver = pro.getProperty(&quot;driver&quot;);</span><br><span class="line">            //4. 注册驱动</span><br><span class="line">            Class.forName(driver);</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取连接</span><br><span class="line">     * @return 连接对象</span><br><span class="line">     */</span><br><span class="line">    public static Connection getConnection() throws SQLException &#123;</span><br><span class="line"></span><br><span class="line">        return DriverManager.getConnection(url, user, password);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 释放资源</span><br><span class="line">     * @param stmt</span><br><span class="line">     * @param conn</span><br><span class="line">     */</span><br><span class="line">    public static void close(Statement stmt,Connection conn)&#123;</span><br><span class="line">        if( stmt != null)&#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                stmt.close();</span><br><span class="line">            &#125; catch (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if( conn != null)&#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                conn.close();</span><br><span class="line">            &#125; catch (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 释放资源</span><br><span class="line">     * @param stmt</span><br><span class="line">     * @param conn</span><br><span class="line">     */</span><br><span class="line">    public static void close(ResultSet rs,Statement stmt, Connection conn)&#123;</span><br><span class="line">        if( rs != null)&#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                rs.close();</span><br><span class="line">            &#125; catch (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if( stmt != null)&#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                stmt.close();</span><br><span class="line">            &#125; catch (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if( conn != null)&#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                conn.close();</span><br><span class="line">            &#125; catch (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>练习：</p>
<ul>
<li><p>需求：</p>
<pre><code>1. 通过键盘录入用户名和密码
2. 判断用户是否登录成功
    * select * from user where username = &quot;&quot; and password = &quot;&quot;;
    * 如果这个sql有查询结果，则成功，反之，则失败</code></pre></li>
<li><p>步骤：</p>
<ul>
<li><p>创建数据库表 user</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE USER(</span><br><span class="line">	id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">	username VARCHAR(32),</span><br><span class="line">	PASSWORD VARCHAR(32)</span><br><span class="line"></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">INSERT INTO USER VALUES(NULL,&apos;zhangsan&apos;,&apos;123&apos;);</span><br><span class="line">INSERT INTO USER VALUES(NULL,&apos;lisi&apos;,&apos;234&apos;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>代码实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">public class JDBCDemo9 &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        //1.键盘录入，接受用户名和密码</span><br><span class="line">        Scanner sc = new Scanner(System.in);</span><br><span class="line">        System.out.println(&quot;请输入用户名：&quot;);</span><br><span class="line">        String username = sc.nextLine();</span><br><span class="line">        System.out.println(&quot;请输入密码：&quot;);</span><br><span class="line">        String password = sc.nextLine();</span><br><span class="line">        //2.调用方法</span><br><span class="line">        boolean flag = new JDBCDemo9().login(username, password);</span><br><span class="line">        //3.判断结果，输出不同语句</span><br><span class="line">        if(flag)&#123;</span><br><span class="line">            //登录成功</span><br><span class="line">            System.out.println(&quot;登录成功！&quot;);</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            System.out.println(&quot;用户名或密码错误！&quot;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 登录方法</span><br><span class="line">     */</span><br><span class="line">    public boolean login(String username ,String password)&#123;</span><br><span class="line">        if(username == null || password == null)&#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        //连接数据库判断是否登录成功</span><br><span class="line">        Connection conn = null;</span><br><span class="line">        Statement stmt =  null;</span><br><span class="line">        ResultSet rs = null;</span><br><span class="line">        //1.获取连接</span><br><span class="line">        try &#123;</span><br><span class="line">            conn =  JDBCUtils.getConnection();</span><br><span class="line">            //2.定义sql</span><br><span class="line">            String sql = &quot;select * from user where username = &apos;&quot;+username+&quot;&apos; and password = &apos;&quot;+password+&quot;&apos; &quot;;</span><br><span class="line">            //3.获取执行sql的对象</span><br><span class="line">            stmt = conn.createStatement();</span><br><span class="line">            //4.执行查询</span><br><span class="line">            rs = stmt.executeQuery(sql);</span><br><span class="line">            //5.判断</span><br><span class="line">           /* if(rs.next())&#123;//如果有下一行，则返回true</span><br><span class="line">                return true;</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                return false;</span><br><span class="line">            &#125;*/</span><br><span class="line">           return rs.next();//如果有下一行，则返回true</span><br><span class="line"></span><br><span class="line">        &#125; catch (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;finally &#123;</span><br><span class="line">            JDBCUtils.close(rs,stmt,conn);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="三、JDBC控制事务"><a href="#三、JDBC控制事务" class="headerlink" title="三、JDBC控制事务"></a>三、JDBC控制事务</h2><h3 id="1、事务"><a href="#1、事务" class="headerlink" title="1、事务"></a>1、事务</h3><p><strong>一个包含多个步骤的业务操作。如果这个业务操作被事务管理，则这多个步骤要么同时成功，要么同时失败。</strong></p>
<h3 id="2、操作"><a href="#2、操作" class="headerlink" title="2、操作"></a>2、操作</h3><ul>
<li>开启事务</li>
<li>提交事务</li>
<li>回滚事务</li>
</ul>
<h3 id="3、使用Connection对象来管理事务"><a href="#3、使用Connection对象来管理事务" class="headerlink" title="3、使用Connection对象来管理事务"></a>3、使用Connection对象来管理事务</h3><ul>
<li><strong>开启事务</strong>：<code>setAutoCommit(boolean autoCommit)</code> ：调用该方法设置参数为false，即开启事务<ul>
<li><strong>在执行sql之前开启事务</strong></li>
</ul>
</li>
<li><strong>提交事务</strong>：<code>commit()</code><ul>
<li><strong>当所有sql都执行完提交事务</strong></li>
</ul>
</li>
<li><strong>回滚事务</strong>：<code>rollback()</code><ul>
<li><strong>在catch中回滚事务</strong></li>
</ul>
</li>
</ul>
<h3 id="4、示例代码"><a href="#4、示例代码" class="headerlink" title="4、示例代码"></a>4、示例代码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">public class JDBCDemo10 &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Connection conn = null;</span><br><span class="line">        PreparedStatement pstmt1 = null;</span><br><span class="line">        PreparedStatement pstmt2 = null;</span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line">            //1.获取连接</span><br><span class="line">            conn = JDBCUtils.getConnection();</span><br><span class="line">            //开启事务</span><br><span class="line">            conn.setAutoCommit(false);</span><br><span class="line"></span><br><span class="line">            //2.定义sql</span><br><span class="line">            //2.1 张三 - 500</span><br><span class="line">            String sql1 = &quot;update account set balance = balance - ? where id = ?&quot;;</span><br><span class="line">            //2.2 李四 + 500</span><br><span class="line">            String sql2 = &quot;update account set balance = balance + ? where id = ?&quot;;</span><br><span class="line">            //3.获取执行sql对象</span><br><span class="line">            pstmt1 = conn.prepareStatement(sql1);</span><br><span class="line">            pstmt2 = conn.prepareStatement(sql2);</span><br><span class="line">            //4. 设置参数</span><br><span class="line">            pstmt1.setDouble(1,500);</span><br><span class="line">            pstmt1.setInt(2,1);</span><br><span class="line"></span><br><span class="line">            pstmt2.setDouble(1,500);</span><br><span class="line">            pstmt2.setInt(2,2);</span><br><span class="line">            //5.执行sql</span><br><span class="line">            pstmt1.executeUpdate();</span><br><span class="line">            // 手动制造异常</span><br><span class="line">            int i = 3/0;</span><br><span class="line"></span><br><span class="line">            pstmt2.executeUpdate();</span><br><span class="line">            //提交事务</span><br><span class="line">            conn.commit();</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            //事务回滚</span><br><span class="line">            try &#123;</span><br><span class="line">                if(conn != null) &#123;</span><br><span class="line">                    conn.rollback();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; catch (SQLException e1) &#123;</span><br><span class="line">                e1.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;finally &#123;</span><br><span class="line">            JDBCUtils.close(pstmt1,conn);</span><br><span class="line">            JDBCUtils.close(pstmt2,null);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="四、备注"><a href="#四、备注" class="headerlink" title="四、备注"></a>四、备注</h2><p>该篇Blog中的所有练习实例代码均已上传，如需请访问<a href="https://github.com/AllenXueKY/JavaWeb/tree/master/JDBC" target="_blank" rel="noopener">链接</a></p>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>Allen Xue</span>
                    </p>
                
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2019 <a href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                
                     <p class="copyright-item">
                         <span>Slogan:</span>
                         <span><strong>To be or not to be,that is a question.<strong></strong></strong></span>
                     </p>
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tag/JavaWeb/"># JavaWeb</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
            
            <a class="next" rel="next" href="/2020/02/26/MySQL8-0连接配置（Java版）/">MySQL8.0连接配置（Java版）</a>
            
        </section>


    </article>
</div>

        </div>
        <footer id="footer" class="footer">
    <div class="copyright">
        <span>© Allen Xue | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
    
        <script type="text/javascript" color="0,0,0" opacity="0.3" zindex="-2" count="99" src="/js/canvas-nest.js"></script>
    
</body>
</html>
