<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">



<title>SpringMVC框架之再见已是沧海桑田 | Allen Xue&#39;s Blog</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


</head>
<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">Allen Xue&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>

        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">Allen Xue&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
        <div class="main">
            <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">SpringMVC框架之再见已是沧海桑田</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">Allen Xue</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">March 28, 2020&nbsp;&nbsp;23:13:29</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/category/Java-EE/">Java_EE</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p><em>个人建议，如果对SpringMVC框架没有接触过的先看之前的文章，点击前往<a href="https://blog.csdn.net/qq_34504626/article/details/105105846" target="_blank" rel="noopener">SpringMVC框架之初次见面请多多关照</a></em></p>
<p><strong>本文主要是在之前的基础上再学习一些常用的配置，主要是通过使用和配置SpringMVC框架来更加方便快捷地完成以下内容</strong>：</p>
<ul>
<li><strong>响应数据和结果视图</strong></li>
<li><strong>文件上传</strong></li>
<li><strong>异常处理</strong></li>
<li><strong>拦截器</strong></li>
</ul>
<h2 id="一、响应数据和结果视图"><a href="#一、响应数据和结果视图" class="headerlink" title="一、响应数据和结果视图"></a>一、响应数据和结果视图</h2><h3 id="1、返回值分类"><a href="#1、返回值分类" class="headerlink" title="1、返回值分类"></a>1、返回值分类</h3><h4 id="（1）返回字符串"><a href="#（1）返回字符串" class="headerlink" title="（1）返回字符串"></a>（1）返回字符串</h4><ul>
<li><p><strong>Controller中的方法返回字符串可以指定逻辑视图的名称，根据视图解析器为物理视图的地址</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(value=&quot;/hello&quot;)</span><br><span class="line">public String sayHello() &#123;</span><br><span class="line">    System.out.println(&quot;Hello SpringMVC!!&quot;);</span><br><span class="line">    // 跳转到成功页面</span><br><span class="line">    return &quot;success&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>具体的应用场景</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">//控制器代码</span><br><span class="line">@Controller</span><br><span class="line">@RequestMapping(&quot;/user&quot;)</span><br><span class="line">public class UserController &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 返回值类型是字符串</span><br><span class="line">     * @param model</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    @RequestMapping(&quot;/testString&quot;)</span><br><span class="line">    public String testString(Model model)&#123;</span><br><span class="line">        System.out.println(&quot;testString方法执行了。。。&quot;);</span><br><span class="line">        //模拟从数据库中查询出User对象</span><br><span class="line">        user.setUsername(&quot;美美&quot;);</span><br><span class="line">        user.setPassword(&quot;123&quot;);</span><br><span class="line">        user.setAge(30);</span><br><span class="line">        //model对象</span><br><span class="line">        model.addAttribute(&quot;user&quot;,user);</span><br><span class="line">        return &quot;success&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="（2）返回值是void"><a href="#（2）返回值是void" class="headerlink" title="（2）返回值是void"></a>（2）返回值是void</h4><ul>
<li><strong>如果控制器的方法返回值编写成void，执行程序报404的异常，默认查找JSP页面没有找到</strong><ul>
<li><em>默认会跳转到<code>@RequestMapping(value=&quot;/testVoid&quot;)</code>注解中的 <strong>user/testVoid</strong> 页面</em></li>
</ul>
</li>
<li><strong>可以使用请求转发或者重定向跳转到指定的页面</strong>，代码如下：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">//控制器代码</span><br><span class="line">@Controller</span><br><span class="line">@RequestMapping(&quot;/user&quot;)</span><br><span class="line">public class UserController &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 返回值类型是void</span><br><span class="line">     * 请求转发一次请求，不用编写项目的名称</span><br><span class="line">     */</span><br><span class="line">    @RequestMapping(&quot;/testVoid&quot;)</span><br><span class="line">    public void testVoid(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123;</span><br><span class="line">        System.out.println(&quot;testVoid方法执行了。。。&quot;);</span><br><span class="line">        //编写请求转发的程序</span><br><span class="line">        //request.getRequestDispatcher(&quot;/WEB-INF/pages/success.jsp&quot;).forward(request,response);</span><br><span class="line">    </span><br><span class="line">        //重定向</span><br><span class="line">        //response.sendRedirect(request.getContextPath()+&quot;/index.jsp&quot;);</span><br><span class="line">    </span><br><span class="line">        //设置中文乱码</span><br><span class="line">        response.setCharacterEncoding(&quot;utf-8&quot;);</span><br><span class="line">        response.setContentType(&quot;text/html;charset=utf-8&quot;);</span><br><span class="line">    </span><br><span class="line">        //直接会进行响应</span><br><span class="line">        response.getWriter().print(&quot;你好&quot;);</span><br><span class="line">    </span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><img src="/2020/03/28/SpringMVC框架之再见已是沧海桑田/1.png" alt="image"></p>
<h4 id="（3）返回值是ModelAndView对象"><a href="#（3）返回值是ModelAndView对象" class="headerlink" title="（3）返回值是ModelAndView对象"></a>（3）返回值是ModelAndView对象</h4><ul>
<li><strong>ModelAndView对象是Spring提供的一个对象，可以用来调整具体的JSP视图</strong></li>
<li><strong>具体的代码如下</strong><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">//控制器代码</span><br><span class="line">@Controller</span><br><span class="line">@RequestMapping(&quot;/user&quot;)</span><br><span class="line">public class UserController &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 返回ModelAndView对象</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    @RequestMapping(&quot;/testModelAndView&quot;)</span><br><span class="line">    public ModelAndView testModelAndView()&#123;</span><br><span class="line">        //创建ModelAndView对象</span><br><span class="line">        ModelAndView mv = new ModelAndView();</span><br><span class="line">        System.out.println(&quot;testModelAndView方法执行了。。。&quot;);</span><br><span class="line">        //模拟从数据库中查询出User对象</span><br><span class="line">        user.setUsername(&quot;小风&quot;);</span><br><span class="line">        user.setPassword(&quot;456&quot;);</span><br><span class="line">        user.setAge(30);</span><br><span class="line"></span><br><span class="line">        //把user对象存储到mv对象中，也会把user对象存到request对象</span><br><span class="line">        mv.addObject(&quot;user&quot;,user);</span><br><span class="line"></span><br><span class="line">        //跳转到页面</span><br><span class="line">        mv.setViewName(&quot;success&quot;);</span><br><span class="line"></span><br><span class="line">        return mv;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>可以在跳转的jsp页面中，<strong>使用EL表达式进行展示</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--success.jsp--&gt;</span><br><span class="line">&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; isELIgnored=&quot;false&quot; %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">    &lt;h3&gt;执行成功&lt;/h3&gt;</span><br><span class="line"></span><br><span class="line">    $&#123;user.username&#125;</span><br><span class="line">    $&#123;user.password&#125;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h3 id="2、SpringMVC框架提供的转发和重定向"><a href="#2、SpringMVC框架提供的转发和重定向" class="headerlink" title="2、SpringMVC框架提供的转发和重定向"></a>2、SpringMVC框架提供的转发和重定向</h3><h4 id="（1）forward请求转发"><a href="#（1）forward请求转发" class="headerlink" title="（1）forward请求转发"></a>（1）forward请求转发</h4><ul>
<li><p><strong>controller方法在提供了String类型的返回值之后，默认就是请求转发</strong>。也可以写成下面这种形式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">* 转发</span><br><span class="line">* @return</span><br><span class="line">*/</span><br><span class="line">@RequestMapping(&quot;/testForward&quot;)</span><br><span class="line">public String testForward() &#123;</span><br><span class="line">    System.out.println(&quot;AccountController 的 testForward 方法执行了。。。。&quot;);</span><br><span class="line">    return &quot;forward:/WEB-INF/pages/success.jsp&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>需要注意的是</strong>，如果<strong>用了<code>formward：</code>则路径必须写成实际视图url</strong>，不能写逻辑视图。它相当于<code>request.getRequestDispatcher(&quot;url&quot;).forward(request,response)</code>使用请求转发，<strong>既可以转发到jsp，也可以转发到其他的控制器方法</strong></p>
</li>
</ul>
<h4 id="（2）redirect重定向"><a href="#（2）redirect重定向" class="headerlink" title="（2）redirect重定向"></a>（2）redirect重定向</h4><ul>
<li><strong>contrller方法提供了一个String类型返回值之后，它需要在返回值里使用<code>redirect:</code></strong>，示例如下：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">* 重定向</span><br><span class="line">* @return</span><br><span class="line">*/</span><br><span class="line">@RequestMapping(&quot;/testRedirect&quot;)</span><br><span class="line">public String testRedirect() &#123;</span><br><span class="line">    System.out.println(&quot;AccountController 的 testRedirect 方法执行了。。。。&quot;);</span><br><span class="line">    return &quot;redirect:testReturnModelAndView&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><strong>它相当于<code>response.sendRedirect(url)</code>，需要注意的是，如果是重定向到jsp页面，则jsp页面不能写在WEB-INF目录中，否则无法找到</strong></p>
<h3 id="3、ResponseBody响应json数据"><a href="#3、ResponseBody响应json数据" class="headerlink" title="3、ResponseBody响应json数据"></a>3、ResponseBody响应json数据</h3><p><em>在使用<code>@ResponseBody</code>注解完成响应json数据之前，需要先 *</em>将JQuery的包添加到webapp目录下的js文件夹下<strong>并 **进行一些配置</strong>，否则使用JQuery进行ajax异步请求时无法进行*：</p>
<ul>
<li><p><strong>DispatcherServlet会拦截到所有的资源，导致一个问题就是静态资源（img、css、js）也会被拦截到，从而<br>不能被使用</strong>。解决问题就是<strong>需要配置静态资源不进行拦截，在springmvc.xml配置文件添加如下配置：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 设置静态资源不过滤 --&gt;</span><br><span class="line">&lt;mvc:resources location=&quot;/css/&quot; mapping=&quot;/css/**&quot;/&gt; &lt;!-- 样式 --&gt;</span><br><span class="line">&lt;mvc:resources location=&quot;/images/&quot; mapping=&quot;/images/**&quot;/&gt; &lt;!-- 图片 --&gt;</span><br><span class="line">&lt;mvc:resources location=&quot;/js/&quot; mapping=&quot;/js/**&quot;/&gt; &lt;!-- javascript --&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>mvc:resources</code><strong>标签配置不过滤</strong></p>
<ul>
<li><strong>location元素表示webapp目录下的包下的所有文件</strong></li>
<li><strong>mapping元素表示以/static开头的所有请求路径</strong>，如/static/a 或者/static/a/b</li>
</ul>
</li>
</ul>
<h4 id="（1）在pom文件中导入jar包坐标"><a href="#（1）在pom文件中导入jar包坐标" class="headerlink" title="（1）在pom文件中导入jar包坐标"></a>（1）在pom文件中导入jar包坐标</h4><p><strong>json字符串和JavaBean对象互相转换的过程中，需要使用jackson的jar包</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.9.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jackson-core&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.9.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jackson-annotations&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.9.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h4 id="（2）使用-RequestBody获取请求体数据"><a href="#（2）使用-RequestBody获取请求体数据" class="headerlink" title="（2）使用@RequestBody获取请求体数据"></a>（2）使用<code>@RequestBody</code>获取请求体数据</h4><ul>
<li><p><strong>Controller控制器中添加以下代码：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 模拟异步请求响应</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">@RequestMapping(&quot;/testAjax&quot;)</span><br><span class="line">public @ResponseBody User testAjax(@RequestBody User user)&#123;</span><br><span class="line">    System.out.println(&quot;testAjax方法执行了。。。&quot;);</span><br><span class="line">    System.out.println(user);</span><br><span class="line">    //做出响应，模拟查询数据库</span><br><span class="line">    user.setUsername(&quot;haha&quot;);</span><br><span class="line">    user.setAge(40);</span><br><span class="line">    //做出响应</span><br><span class="line">    return user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>在请求页面jsp中添加如下代码</strong>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- javascript --&gt;</span><br><span class="line">&lt;!--导入JQuery--&gt;</span><br><span class="line">&lt;script src=&quot;js/jquery.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    //页面加载，绑定单击事件</span><br><span class="line">    $(function () &#123;</span><br><span class="line">        $(&quot;#btn&quot;).click(function () &#123;</span><br><span class="line">           //alert(&quot;hello&quot;);</span><br><span class="line">            //发送ajax请求</span><br><span class="line">            $.ajax(&#123;</span><br><span class="line">                //编写json格式，设置属性和值</span><br><span class="line">                url:&quot;user/testAjax&quot;,</span><br><span class="line">                contentType:&quot;application/json;charset=utf-8&quot;,</span><br><span class="line">                data:&apos;&#123;&quot;username&quot;:&quot;hehe&quot;,&quot;password&quot;:&quot;123&quot;,&quot;age&quot;:30&#125;&apos;,</span><br><span class="line">                dataType:&quot;json&quot;,</span><br><span class="line">                type:&quot;post&quot;,</span><br><span class="line">                success:function (data) &#123;</span><br><span class="line">                    //data服务器端响应的json数据，进行解析</span><br><span class="line">                    alert(data);</span><br><span class="line">                    alert(data.username);</span><br><span class="line">                    alert(data.password);</span><br><span class="line">                    alert(data.age);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 测试异步请求 --&gt;</span><br><span class="line">&lt;button id=&quot;btn&quot;&gt;发送ajax的请求&lt;/button&gt;</span><br></pre></td></tr></table></figure>


</li>
</ul>
<h2 id="二、SpringMVC实现文件上传"><a href="#二、SpringMVC实现文件上传" class="headerlink" title="二、SpringMVC实现文件上传"></a>二、SpringMVC实现文件上传</h2><h4 id="文件上传的必要前提"><a href="#文件上传的必要前提" class="headerlink" title="文件上传的必要前提"></a>文件上传的必要前提</h4><ul>
<li><strong>form表单的enctype取值必须是：<code>multipart/form-data</code></strong><ul>
<li>(默认值是:<code>application/x-www-form-urlencoded</code>)</li>
<li><strong>enctype:是表单请求正文的类型</strong></li>
</ul>
</li>
<li><strong>method属性取值必须是Post</strong></li>
<li><strong>提供一个文件选择域<code>&lt;input type=”file” /&gt;</code></strong></li>
</ul>
<h4 id="文件上传的原理分析"><a href="#文件上传的原理分析" class="headerlink" title="文件上传的原理分析"></a>文件上传的原理分析</h4><ul>
<li><strong>当form表单的enctype取值不是默认值后，<code>request.getParameter()</code>将失效</strong></li>
<li><strong><code>enctype=&quot;application/x-www-form-urlencoded&quot;</code>时，form 表单的正文内容是</strong>：<ul>
<li><code>key=value&amp;key=value&amp;key=value</code></li>
</ul>
</li>
<li><strong>当form表单的enctype取值为<code>Mutilpart/form-data</code>时，请求正文内容就变成：</strong><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//每一部分都是MIME类型描述的正文</span><br><span class="line">-----------------------------7de1a433602ac //分界符</span><br><span class="line">Content-Disposition: form-data; name=&quot;userName&quot; //协议头</span><br><span class="line">aaa //协议的正文</span><br><span class="line">-----------------------------7de1a433602ac</span><br><span class="line">Content-Disposition: form-data; name=&quot;file&quot;;</span><br><span class="line">filename=&quot;C:\Users\zhy\Desktop\fileupload_demofile\b.txt&quot;</span><br><span class="line">Content-Type: text/plain //协议的类型（MIME 类型）</span><br><span class="line">bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb</span><br><span class="line">-----------------------------7de1a433602ac--</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="借助第三方组件实现文件上传"><a href="#借助第三方组件实现文件上传" class="headerlink" title="借助第三方组件实现文件上传"></a>借助第三方组件实现文件上传</h4><p><strong>使用Commons-fileupload组件实现文件上传，需要导入该组件相应的支撑jar包：Commons-fileupload和commons-io。</strong> <em>commons-io不属于文件上传组件的开发jar文件，但Commons-fileupload组件从1.1版本开始，它工作时需要commons-io包的支持</em></p>
<h3 id="1、传统文件上传的回顾"><a href="#1、传统文件上传的回顾" class="headerlink" title="1、传统文件上传的回顾"></a>1、传统文件上传的回顾</h3><h4 id="（1）导入文件上传的jar包"><a href="#（1）导入文件上传的jar包" class="headerlink" title="（1）导入文件上传的jar包"></a>（1）导入文件上传的jar包</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;commons-fileupload&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;commons-fileupload&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.3.1&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;commons-io&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;commons-io&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.4&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h4 id="（2）编写文件上传的JSP页面"><a href="#（2）编写文件上传的JSP页面" class="headerlink" title="（2）编写文件上传的JSP页面"></a>（2）编写文件上传的JSP页面</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">    &lt;h3&gt;传统文件上传&lt;/h3&gt;</span><br><span class="line"></span><br><span class="line">    &lt;form action=&quot;user/fileupload1&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span><br><span class="line">        选择文件：&lt;input type=&quot;file&quot; name=&quot;upload&quot;&gt;&lt;br&gt;</span><br><span class="line">        &lt;input type=&quot;submit&quot; value=&quot;上传&quot;&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h4 id="（3）编写文件上传的Controller控制器"><a href="#（3）编写文件上传的Controller控制器" class="headerlink" title="（3）编写文件上传的Controller控制器"></a>（3）编写文件上传的Controller控制器</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 文件上传</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">@RequestMapping(&quot;/fileupload1&quot;)</span><br><span class="line">public String fileupload1(HttpServletRequest request) throws Exception &#123;</span><br><span class="line">    System.out.println(&quot;文件上传。。。&quot;);</span><br><span class="line"></span><br><span class="line">    //使用fileupload组件完成文件上传</span><br><span class="line">    //上传的位置</span><br><span class="line">    String realPath = request.getSession().getServletContext().getRealPath(&quot;/uploads/&quot;);</span><br><span class="line">    //判断，该路径是否存在</span><br><span class="line">    File file = new File(realPath);</span><br><span class="line">    if(!file.exists())&#123;</span><br><span class="line">        //创建该文件夹</span><br><span class="line">        file.mkdirs();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //解析request对象，获取上传文件项</span><br><span class="line">    DiskFileItemFactory factory = new DiskFileItemFactory();</span><br><span class="line">    ServletFileUpload upload = new ServletFileUpload(factory);</span><br><span class="line">    //解析request</span><br><span class="line">    List&lt;FileItem&gt; items = upload.parseRequest(request);</span><br><span class="line">    //遍历</span><br><span class="line">    for (FileItem item : items) &#123;</span><br><span class="line">        //进行判断，当前item对象是否是上传文件项</span><br><span class="line">        if(item.isFormField())&#123;</span><br><span class="line">            //说明是普通表单项</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">            //说明是上传项</span><br><span class="line">            //获取上传文件的名称</span><br><span class="line">            String filename = item.getName();</span><br><span class="line">            //把文件的名称设置成唯一值，uuid</span><br><span class="line">            String uuid = UUID.randomUUID().toString().replace(&quot;-&quot;, &quot;&quot;);</span><br><span class="line">            filename = uuid+&quot;_&quot;+filename;</span><br><span class="line">            //完成文件上传</span><br><span class="line">            item.write(new File(realPath,filename));</span><br><span class="line">            //删除临时文件</span><br><span class="line">            item.delete();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return &quot;success&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2、SpringMVC传统方式文件上传"><a href="#2、SpringMVC传统方式文件上传" class="headerlink" title="2、SpringMVC传统方式文件上传"></a>2、SpringMVC传统方式文件上传</h3><p><strong>SpringMVC框架提供了MultipartFile对象，该对象表示上传的文件，要求变量名称必须和表单file标签的name属性名称相同</strong></p>
<ul>
<li><p><strong>SpringMVC框架文件上传原理分析</strong><br><img src="/2020/03/28/SpringMVC框架之再见已是沧海桑田/2.png" alt="image"></p>
</li>
<li><p><strong>传统方式的文件上传，指的是我们上传的文件和访问的应用存在于同一台服务器上</strong>，并且上传完成之后，浏览器可能跳转</p>
</li>
<li><p><strong>控制器实现代码如下</strong>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * SpringMVC文件上传</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">@RequestMapping(&quot;/fileupload2&quot;)</span><br><span class="line">public String fileupload2(HttpServletRequest request, MultipartFile upload) throws Exception &#123;</span><br><span class="line">    System.out.println(&quot;springmvc文件上传。。。&quot;);</span><br><span class="line"></span><br><span class="line">    //使用fileupload组件完成文件上传</span><br><span class="line">    //上传的位置</span><br><span class="line">    String realPath = request.getSession().getServletContext().getRealPath(&quot;/uploads/&quot;);</span><br><span class="line">    //判断，该路径是否存在</span><br><span class="line">    File file = new File(realPath);</span><br><span class="line">    if(!file.exists())&#123;</span><br><span class="line">        //创建该文件夹</span><br><span class="line">        file.mkdirs();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //说明是上传项</span><br><span class="line">    //获取上传文件的名称</span><br><span class="line">    String filename = upload.getOriginalFilename();</span><br><span class="line">    //把文件的名称设置成唯一值，uuid</span><br><span class="line">    String uuid = UUID.randomUUID().toString().replace(&quot;-&quot;, &quot;&quot;);</span><br><span class="line">    filename = uuid+&quot;_&quot;+filename;</span><br><span class="line">    //完成文件上传</span><br><span class="line">    upload.transferTo(new File(realPath,filename));</span><br><span class="line"></span><br><span class="line">    return &quot;success&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>在springmvc.xml配置文件中配置解析器对象</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--配置文件解析器对象--&gt;</span><br><span class="line">&lt;bean id=&quot;multipartResolver&quot; class=&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;&gt;</span><br><span class="line">    &lt;!--文件上传大小最大值10*1024*1024=10M--&gt;</span><br><span class="line">    &lt;property name=&quot;maxUploadSize&quot; value=&quot;10485760&quot;&gt;&lt;/property&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>==<strong>注意：文件上传的解析器id是固定的，不能起别的名称，否则无法实现请求参数的绑定。（不光是文件，其他字段也将无法绑定）</strong>==</p>
<h3 id="3、SpringMVC跨服务器方式文件上传"><a href="#3、SpringMVC跨服务器方式文件上传" class="headerlink" title="3、SpringMVC跨服务器方式文件上传"></a>3、SpringMVC跨服务器方式文件上传</h3><h5 id="分服务器的目的"><a href="#分服务器的目的" class="headerlink" title="分服务器的目的"></a>分服务器的目的</h5><p><strong>在实际开发中，我们会有很多处理不同功能的服务器</strong>。例如：</p>
<ul>
<li><strong>应用服务器</strong>：负责部署我们的应用</li>
<li><strong>数据库服务器</strong>：运行我们的数据库</li>
<li><strong>缓存和消息服务器</strong>：负责处理大并发访问的缓存和消息</li>
<li><strong>文件服务器</strong>：负责存储用户上传文件的服务器。</li>
</ul>
<p><strong>(注意：此处说的不是服务器集群）</strong><br><img src="/2020/03/28/SpringMVC框架之再见已是沧海桑田/3.png" alt="image"></p>
<h4 id="（1）搭建图片服务器"><a href="#（1）搭建图片服务器" class="headerlink" title="（1）搭建图片服务器"></a>（1）搭建图片服务器</h4><h5 id="第一步：修改tomcat配置"><a href="#第一步：修改tomcat配置" class="headerlink" title="第一步：修改tomcat配置"></a>第一步：修改tomcat配置</h5><ul>
<li><strong>在tomcat安装目录下找到/conf/web.xml配置文件并打开</strong><br><img src="/2020/03/28/SpringMVC框架之再见已是沧海桑田/4.png" alt="image"></li>
<li><strong>找到<code>servlet</code>标签并添加如下配置：</strong><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;init-param&gt;</span><br><span class="line">	&lt;param-name&gt;readonly&lt;/param-name&gt;</span><br><span class="line">	&lt;param-value&gt;false&lt;/param-value&gt;</span><br><span class="line">&lt;/init-param&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><img src="/2020/03/28/SpringMVC框架之再见已是沧海桑田/5.png" alt="image"></p>
<h5 id="第二步：创建maven项目并启动Tomcat进行测试"><a href="#第二步：创建maven项目并启动Tomcat进行测试" class="headerlink" title="第二步：创建maven项目并启动Tomcat进行测试"></a>第二步：创建maven项目并启动Tomcat进行测试</h5><p><em>选择maven中的webapp骨架并创建，不需要配置任何东西</em>，然后<strong>在idea中将该项目添加到tomcat中并修改tomcat的端口号</strong>，然后<strong>启动Tomcat服务器进行测试</strong><br><img src="/2020/03/28/SpringMVC框架之再见已是沧海桑田/6.png" alt="image"><br><img src="/2020/03/28/SpringMVC框架之再见已是沧海桑田/7.png" alt="image"></p>
<h4 id="（2）实现SpringMVC跨服务器方式文件上传"><a href="#（2）实现SpringMVC跨服务器方式文件上传" class="headerlink" title="（2）实现SpringMVC跨服务器方式文件上传"></a>（2）实现SpringMVC跨服务器方式文件上传</h4><h5 id="第一步：导入开发需要的jar包"><a href="#第一步：导入开发需要的jar包" class="headerlink" title="第一步：导入开发需要的jar包"></a>第一步：导入开发需要的jar包</h5><p>在pom配置文件中添加以下依赖坐标</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;com.sun.jersey&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;jersey-core&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;1.18.1&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;com.sun.jersey&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;jersey-client&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;1.18.1&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h5 id="第二步：编写文件上传的JSP页面"><a href="#第二步：编写文件上传的JSP页面" class="headerlink" title="第二步：编写文件上传的JSP页面"></a>第二步：编写文件上传的JSP页面</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;h3&gt;跨服务器文件上传&lt;/h3&gt;</span><br><span class="line"></span><br><span class="line">&lt;form action=&quot;user/fileupload3&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span><br><span class="line">    选择文件：&lt;input type=&quot;file&quot; name=&quot;upload&quot;&gt;&lt;br&gt;</span><br><span class="line">    &lt;input type=&quot;submit&quot; value=&quot;上传&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<h5 id="第三步：编写控制器"><a href="#第三步：编写控制器" class="headerlink" title="第三步：编写控制器"></a>第三步：编写控制器</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 跨服务器文件上传</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">@RequestMapping(&quot;/fileupload3&quot;)</span><br><span class="line">public String fileupload3(MultipartFile upload) throws Exception &#123;</span><br><span class="line">    System.out.println(&quot;跨服务器文件上传。。。&quot;);</span><br><span class="line"></span><br><span class="line">    //定义上传文件服务器路径</span><br><span class="line">    String path = &quot;http://localhost:9090/uploads/&quot;;</span><br><span class="line"></span><br><span class="line">    //说明是上传项</span><br><span class="line">    //获取上传文件的名称</span><br><span class="line">    String filename = upload.getOriginalFilename();</span><br><span class="line">    //把文件的名称设置成唯一值，uuid</span><br><span class="line">    String uuid = UUID.randomUUID().toString().replace(&quot;-&quot;, &quot;&quot;);</span><br><span class="line">    filename = uuid+&quot;_&quot;+filename;</span><br><span class="line">    //完成文件上传，跨服务器上传</span><br><span class="line">    //创建客户端对象</span><br><span class="line">    Client client = Client.create();</span><br><span class="line">    //和图片服务器进行连接</span><br><span class="line">    WebResource webResource = client.resource(path + filename);</span><br><span class="line">    //上传文件</span><br><span class="line">    webResource.put(upload.getBytes());</span><br><span class="line"></span><br><span class="line">    return &quot;success&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="第四步：启动两个项目的tomcat服务器进行测试"><a href="#第四步：启动两个项目的tomcat服务器进行测试" class="headerlink" title="第四步：启动两个项目的tomcat服务器进行测试"></a>第四步：启动两个项目的tomcat服务器进行测试</h5><p><strong>点击上传按钮后，你会惊奇地发现500错误</strong>，<strong>原因：在图片服务器中未找到uploads文件夹</strong>，所以这里<em>需要在图片服务器的那个项目的工作空间下，找到target目录，然后在项目名称目录下创建一个名为uploads的文件夹即可。</em><br><img src="/2020/03/28/SpringMVC框架之再见已是沧海桑田/8.png" alt="image"></p>
<h2 id="三、SpringMVC的异常处理"><a href="#三、SpringMVC的异常处理" class="headerlink" title="三、SpringMVC的异常处理"></a>三、SpringMVC的异常处理</h2><h3 id="1、异常处理的思路"><a href="#1、异常处理的思路" class="headerlink" title="1、异常处理的思路"></a>1、异常处理的思路</h3><p><strong>系统中异常包括两类：预期异常和运行时异常RuntimeException</strong>，<em>前者通过捕获异常从而获取异常信息，后者主要通过规范代码开发、测试通过手段减少运行时异常的发生</em></p>
<p><strong>系统的dao、service、controller出现都通过<code>throws Exception</code>向上抛出，最后由springmvc前端控制器交由异常处理器进行异常处理，如下图：</strong><br><img src="/2020/03/28/SpringMVC框架之再见已是沧海桑田/9.png" alt="image"></p>
<h3 id="2、SpringMVC的异常处理"><a href="#2、SpringMVC的异常处理" class="headerlink" title="2、SpringMVC的异常处理"></a>2、SpringMVC的异常处理</h3><h4 id="（1）创建自定义异常类"><a href="#（1）创建自定义异常类" class="headerlink" title="（1）创建自定义异常类"></a>（1）创建自定义异常类</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">package com.allen.exception;</span><br><span class="line"></span><br><span class="line">public class SysException extends Exception&#123;</span><br><span class="line"></span><br><span class="line">    //存储提示信息的</span><br><span class="line">    private String message;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String getMessage() &#123;</span><br><span class="line">        return message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setMessage(String message) &#123;</span><br><span class="line">        this.message = message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public SysException(String message) &#123;</span><br><span class="line">        this.message = message;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="（2）自定义异常处理器进行页面跳转"><a href="#（2）自定义异常处理器进行页面跳转" class="headerlink" title="（2）自定义异常处理器进行页面跳转"></a>（2）自定义异常处理器进行页面跳转</h4><p><strong>将原本在页面上显示的异常信息不在页面上显示，而显示一些较为友好的页面</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">package com.allen.exception;</span><br><span class="line"></span><br><span class="line">import org.springframework.web.servlet.HandlerExceptionResolver;</span><br><span class="line">import org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 异常处理器</span><br><span class="line"> */</span><br><span class="line">public class SysExceptionResolver implements HandlerExceptionResolver &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 处理异常业务逻辑</span><br><span class="line">     * @param httpServletRequest</span><br><span class="line">     * @param httpServletResponse</span><br><span class="line">     * @param handler</span><br><span class="line">     * @param ex</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public ModelAndView resolveException(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object handler, Exception ex) &#123;</span><br><span class="line">        //获取到异常对象</span><br><span class="line">        SysException e = null;</span><br><span class="line">        if(ex instanceof SysException)&#123;</span><br><span class="line">            e = (SysException)ex;</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">            e = new SysException(&quot;系统正在维护。。。&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        //创建ModelAndView对象</span><br><span class="line">        ModelAndView mv = new ModelAndView();</span><br><span class="line">        mv.addObject(&quot;errorMsg&quot;,e.getMessage());</span><br><span class="line">        mv.setViewName(&quot;error&quot;);</span><br><span class="line">        return mv;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>error.jsp中通过EL表达式显示提示信息</strong><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; isELIgnored=&quot;false&quot; %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">    $&#123;errorMsg&#125;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="（3）配置异常处理器"><a href="#（3）配置异常处理器" class="headerlink" title="（3）配置异常处理器"></a>（3）配置异常处理器</h4><p>在springmvc.xml配置文件中配置异常处理器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--配置异常处理器--&gt;</span><br><span class="line">&lt;bean id=&quot;sysExceptionResolver&quot; class=&quot;com.allen.exception.SysExceptionResolver&quot;&gt;&lt;/bean&gt;</span><br></pre></td></tr></table></figure>

<h4 id="（4）在控制器中模拟异常进行测试"><a href="#（4）在控制器中模拟异常进行测试" class="headerlink" title="（4）在控制器中模拟异常进行测试"></a>（4）在控制器中模拟异常进行测试</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">package com.allen.controller;</span><br><span class="line"></span><br><span class="line">import com.allen.exception.SysException;</span><br><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line">@Controller</span><br><span class="line">@RequestMapping(&quot;/user&quot;)</span><br><span class="line">public class UserController &#123;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(&quot;/testException&quot;)</span><br><span class="line">    public String testException() throws SysException&#123;</span><br><span class="line">        System.out.println(&quot;testException执行了。。。&quot;);</span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line">            //模拟异常</span><br><span class="line">            int a = 10/0;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            //抛出自定义异常信息</span><br><span class="line">            throw new SysException(&quot;查询所有用户出现错误了。。。&quot;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return &quot;success&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="四、SpringMVC框架中的拦截器"><a href="#四、SpringMVC框架中的拦截器" class="headerlink" title="四、SpringMVC框架中的拦截器"></a>四、SpringMVC框架中的拦截器</h2><h3 id="1、拦截器的作用"><a href="#1、拦截器的作用" class="headerlink" title="1、拦截器的作用"></a>1、拦截器的作用</h3><p><strong>SpringMVC的处理器拦截器类似于Servlet开发中的过滤器 Filter，用于对处理器进行预处理和后处理</strong></p>
<p><strong>用户可以自己定义一些拦截器来实现特定的功能</strong></p>
<p><em>谈到拦截器，还要向大家提一个词——拦截器链（Interceptor Chain）</em>。<strong>拦截器链就是将拦截器按一定的顺序联结成一条链</strong>。在访问被拦截的方法或字段时，拦截器链中的拦截器就会按其之前定义的顺序被调用。</p>
<p>下面说说<strong>拦截器和过滤器区别</strong>：</p>
<ul>
<li><em>过滤器是servlet规范中的一部分，任何javaweb工程都可以使用</em></li>
<li><strong>拦截器是SpringMVC框架自己的，只有使用了SpringMVC框架的工程才能用</strong></li>
<li><em>过滤器在<code>url-pattern</code>中配置了<code>/*</code>之后，可以对所有要访问的资源拦截</em></li>
<li><strong>拦截器只会拦截访问的控制器方法，如果访问的是jsp，html,css,image 或者js是不会进行拦截的</strong></li>
</ul>
<p><strong>拦截器也是AOP思想的具体应用。</strong></p>
<p><strong>要想自定义拦截器，要求必须实现：HandlerInterceptor 接口</strong></p>
<h3 id="2、自定义拦截器的步骤"><a href="#2、自定义拦截器的步骤" class="headerlink" title="2、自定义拦截器的步骤"></a>2、自定义拦截器的步骤</h3><h4 id="第一步：编写一个普通类实现HandlerInterceptor接口"><a href="#第一步：编写一个普通类实现HandlerInterceptor接口" class="headerlink" title="第一步：编写一个普通类实现HandlerInterceptor接口"></a>第一步：编写一个普通类实现HandlerInterceptor接口</h4><p><strong>创建类，实现HandlerInterceptor接口，重写需要的方法</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">package com.allen.interceptor;</span><br><span class="line"></span><br><span class="line">import org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line">import org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 自定义拦截器</span><br><span class="line"> */</span><br><span class="line">public class MyInterceptor1 implements HandlerInterceptor &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 预处理，controller方法执行前</span><br><span class="line">     * return true 放行，执行下一个拦截器，如果没有，执行controller中的方法</span><br><span class="line">     * return false不放行</span><br><span class="line">     * @param request</span><br><span class="line">     * @param response</span><br><span class="line">     * @param handler</span><br><span class="line">     * @return</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123;</span><br><span class="line">        System.out.println(&quot;MyInterceptor1执行了。。。前&quot;);</span><br><span class="line">        //request.getRequestDispatcher(&quot;/WEB-INF/pages/error.jsp&quot;).forward(request,response);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 后处理方法，controller方法执行后，success.jsp执行之前</span><br><span class="line">     * @param request</span><br><span class="line">     * @param response</span><br><span class="line">     * @param handler</span><br><span class="line">     * @param modelAndView</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception &#123;</span><br><span class="line">        System.out.println(&quot;MyInterceptor1执行了。。。后&quot;);</span><br><span class="line">        //request.getRequestDispatcher(&quot;/WEB-INF/pages/error.jsp&quot;).forward(request,response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * success.jsp页面执行后，该方法会执行</span><br><span class="line">     * @param request</span><br><span class="line">     * @param response</span><br><span class="line">     * @param handler</span><br><span class="line">     * @param ex</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception &#123;</span><br><span class="line">        System.out.println(&quot;MyInterceptor1执行了。。。最后&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="第二步：在springmvc-xml中配置拦截器类"><a href="#第二步：在springmvc-xml中配置拦截器类" class="headerlink" title="第二步：在springmvc.xml中配置拦截器类"></a>第二步：在springmvc.xml中配置拦截器类</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--配置拦截器--&gt;</span><br><span class="line">&lt;mvc:interceptors&gt;</span><br><span class="line">    &lt;mvc:interceptor&gt;</span><br><span class="line">        &lt;!--要拦截的具体方法--&gt;</span><br><span class="line">        &lt;mvc:mapping path=&quot;/user/*&quot;/&gt;</span><br><span class="line">        &lt;!--不拦截的方法</span><br><span class="line">        &lt;mvc:exclude-mapping path=&quot;&quot;&gt;&lt;/mvc:exclude-mapping&gt;</span><br><span class="line">        --&gt;</span><br><span class="line">        &lt;!--配置拦截器对象--&gt;</span><br><span class="line">        &lt;bean class=&quot;com.allen.interceptor.MyInterceptor1&quot;&gt;&lt;/bean&gt;</span><br><span class="line">    &lt;/mvc:interceptor&gt;</span><br><span class="line">&lt;/mvc:interceptors&gt;</span><br></pre></td></tr></table></figure>

<h3 id="3、拦截器的细节"><a href="#3、拦截器的细节" class="headerlink" title="3、拦截器的细节"></a>3、拦截器的细节</h3><h4 id="（1）拦截器的放行"><a href="#（1）拦截器的放行" class="headerlink" title="（1）拦截器的放行"></a>（1）拦截器的放行</h4><p><strong>放行的含义是指，如果有下一个拦截器就执行下一个，如果该拦截器处于拦截器链的最后一个，则执行控制器<br>中的方法</strong></p>
<h4 id="（2）拦截器中方法的说明"><a href="#（2）拦截器中方法的说明" class="headerlink" title="（2）拦截器中方法的说明"></a>（2）拦截器中方法的说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">public interface HandlerInterceptor &#123;</span><br><span class="line">    /**</span><br><span class="line">    * 如何调用：</span><br><span class="line">    *   按拦截器定义顺序调用</span><br><span class="line">    * 何时调用：</span><br><span class="line">    *   只要配置了都会调用</span><br><span class="line">    * 有什么用：</span><br><span class="line">    *   如果程序员决定该拦截器对请求进行拦截处理后还要调用其他的拦截器，或者是业务处理器去</span><br><span class="line">    *   进行处理，则返回 true。</span><br><span class="line">    * 如果程序员决定不需要再调用其他的组件去处理请求，则返回 false。</span><br><span class="line">    */</span><br><span class="line">    default boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">    * 如何调用：</span><br><span class="line">    *   按拦截器定义逆序调用</span><br><span class="line">    * 何时调用：</span><br><span class="line">    *   在拦截器链内所有拦截器返成功调用</span><br><span class="line">    * 有什么用：</span><br><span class="line">    *   在业务处理器处理完请求后，但是 DispatcherServlet 向客户端返回响应前被调用，</span><br><span class="line">    *   在该方法中对用户请求 request 进行处理。</span><br><span class="line">    */</span><br><span class="line">    default void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, @Nullable ModelAndView modelAndView) throws Exception &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">    * 如何调用：</span><br><span class="line">    *   按拦截器定义逆序调用</span><br><span class="line">    * 何时调用：</span><br><span class="line">    *   只有 preHandle 返回 true 才调用</span><br><span class="line">    * 有什么用：</span><br><span class="line">    *   在 DispatcherServlet 完全处理完请求后被调用，</span><br><span class="line">    *   可以在该方法中进行一些资源清理的操作。</span><br><span class="line">    */</span><br><span class="line">    default void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, @Nullable Exception ex) throws Exception &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="（3）拦截器的作用路径"><a href="#（3）拦截器的作用路径" class="headerlink" title="（3）拦截器的作用路径"></a>（3）拦截器的作用路径</h4><p><strong>作用路径可以通过在配置文件中配置</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 配置拦截器的作用范围 --&gt;</span><br><span class="line">&lt;mvc:interceptors&gt;</span><br><span class="line">    &lt;mvc:interceptor&gt;</span><br><span class="line">        &lt;mvc:mapping path=&quot;/**&quot; /&gt;&lt;!-- 用于指定对拦截的 url --&gt;</span><br><span class="line">        &lt;mvc:exclude-mapping path=&quot;&quot;/&gt;&lt;!-- 用于指定排除的 url--&gt;</span><br><span class="line">        &lt;bean id=&quot;handlerInterceptorDemo1&quot;</span><br><span class="line">        class=&quot;com.allen.interceptor.MyInterceptor1&quot;&gt;&lt;/bean&gt;</span><br><span class="line">    &lt;/mvc:interceptor&gt;</span><br><span class="line">&lt;/mvc:interceptors&gt;</span><br></pre></td></tr></table></figure>

<h4 id="（4）多个拦截器的执行顺序"><a href="#（4）多个拦截器的执行顺序" class="headerlink" title="（4）多个拦截器的执行顺序"></a>（4）多个拦截器的执行顺序</h4><p><strong>多个拦截器是按照配置的顺序决定的</strong><br><img src="/2020/03/28/SpringMVC框架之再见已是沧海桑田/10.png" alt="image"></p>
<h3 id="4、配置多个拦截器"><a href="#4、配置多个拦截器" class="headerlink" title="4、配置多个拦截器"></a>4、配置多个拦截器</h3><h4 id="（1）再编写一个拦截器的类"><a href="#（1）再编写一个拦截器的类" class="headerlink" title="（1）再编写一个拦截器的类"></a>（1）再编写一个拦截器的类</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">package com.allen.interceptor;</span><br><span class="line"></span><br><span class="line">import org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line">import org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 自定义拦截器</span><br><span class="line"> */</span><br><span class="line">public class MyInterceptor2 implements HandlerInterceptor &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 预处理，controller方法执行前</span><br><span class="line">     * return true 放行，执行下一个拦截器，如果没有，执行controller中的方法</span><br><span class="line">     * return false不放行</span><br><span class="line">     * @param request</span><br><span class="line">     * @param response</span><br><span class="line">     * @param handler</span><br><span class="line">     * @return</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123;</span><br><span class="line">        System.out.println(&quot;MyInterceptor1执行了。。。前222&quot;);</span><br><span class="line">        //request.getRequestDispatcher(&quot;/WEB-INF/pages/error.jsp&quot;).forward(request,response);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 后处理方法，controller方法执行后，success.jsp执行之前</span><br><span class="line">     * @param request</span><br><span class="line">     * @param response</span><br><span class="line">     * @param handler</span><br><span class="line">     * @param modelAndView</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception &#123;</span><br><span class="line">        System.out.println(&quot;MyInterceptor1执行了。。。后222&quot;);</span><br><span class="line">        //request.getRequestDispatcher(&quot;/WEB-INF/pages/error.jsp&quot;).forward(request,response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * success.jsp页面执行后，该方法会执行</span><br><span class="line">     * @param request</span><br><span class="line">     * @param response</span><br><span class="line">     * @param handler</span><br><span class="line">     * @param ex</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception &#123;</span><br><span class="line">        System.out.println(&quot;MyInterceptor1执行了。。。最后222&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="（2）配置2个拦截器"><a href="#（2）配置2个拦截器" class="headerlink" title="（2）配置2个拦截器"></a>（2）配置2个拦截器</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--配置拦截器--&gt;</span><br><span class="line">&lt;mvc:interceptors&gt;</span><br><span class="line">    &lt;!--配置拦截器--&gt;</span><br><span class="line">    &lt;mvc:interceptor&gt;</span><br><span class="line">        &lt;!--要拦截的具体方法--&gt;</span><br><span class="line">        &lt;mvc:mapping path=&quot;/user/*&quot;/&gt;</span><br><span class="line">        &lt;!--不拦截的方法</span><br><span class="line">        &lt;mvc:exclude-mapping path=&quot;&quot;&gt;&lt;/mvc:exclude-mapping&gt;</span><br><span class="line">        --&gt;</span><br><span class="line">        &lt;!--配置拦截器对象--&gt;</span><br><span class="line">        &lt;bean class=&quot;com.allen.interceptor.MyInterceptor1&quot;&gt;&lt;/bean&gt;</span><br><span class="line">    &lt;/mvc:interceptor&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--配置第二个拦截器--&gt;</span><br><span class="line">    &lt;mvc:interceptor&gt;</span><br><span class="line">        &lt;!--要拦截的具体方法--&gt;</span><br><span class="line">        &lt;mvc:mapping path=&quot;/**&quot;/&gt;</span><br><span class="line">        &lt;!--不拦截的方法</span><br><span class="line">        &lt;mvc:exclude-mapping path=&quot;&quot;&gt;&lt;/mvc:exclude-mapping&gt;</span><br><span class="line">        --&gt;</span><br><span class="line">        &lt;!--配置拦截器对象--&gt;</span><br><span class="line">        &lt;bean class=&quot;com.allen.interceptor.MyInterceptor2&quot;&gt;&lt;/bean&gt;</span><br><span class="line">    &lt;/mvc:interceptor&gt;</span><br><span class="line">&lt;/mvc:interceptors&gt;</span><br></pre></td></tr></table></figure>

<h4 id="（3）测试拦截器"><a href="#（3）测试拦截器" class="headerlink" title="（3）测试拦截器"></a>（3）测试拦截器</h4><ul>
<li><p><strong>控制器代码</strong>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">package com.allen.controller;</span><br><span class="line"></span><br><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line">@Controller</span><br><span class="line">@RequestMapping(&quot;/user&quot;)</span><br><span class="line">public class UserController &#123;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(&quot;/testInterceptor&quot;)</span><br><span class="line">    public String testInterceptor()&#123;</span><br><span class="line">        System.out.println(&quot;testInterceptor执行了。。。&quot;);</span><br><span class="line">        return &quot;success&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>success.jsp代码</strong>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">    &lt;h3&gt;执行成功&lt;/h3&gt;</span><br><span class="line"></span><br><span class="line">    &lt;% System.out.println(&quot;success.jsp执行了。。。&quot;);%&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>执行结果</strong>：<br><img src="/2020/03/28/SpringMVC框架之再见已是沧海桑田/11.png" alt="image"></p>
</li>
</ul>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>Allen Xue</span>
                    </p>
                
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2019 <a href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                
                     <p class="copyright-item">
                         <span>Slogan:</span>
                         <span><strong>To be or not to be,that is a question.<strong></strong></strong></span>
                     </p>
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tag/Java-EE/"># Java_EE</a>
                    
                        <a href="/tag/SpringMVC/"># SpringMVC</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
            
            <a class="next" rel="next" href="/2020/03/25/SpringMVC框架之初次见面请多多关照/">SpringMVC框架之初次见面请多多关照</a>
            
        </section>


    </article>
</div>

        </div>
        <footer id="footer" class="footer">
    <div class="copyright">
        <span>© Allen Xue | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
    
        <script type="text/javascript" color="0,0,0" opacity="0.3" zindex="-2" count="99" src="/js/canvas-nest.js"></script>
    
</body>
</html>
