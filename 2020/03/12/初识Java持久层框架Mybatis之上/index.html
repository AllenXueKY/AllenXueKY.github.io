<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">



<title>初识Java持久层框架Mybatis之上 | Allen Xue&#39;s Blog</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


</head>
<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">Allen Xue&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>

        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">Allen Xue&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
        <div class="main">
            <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">初识Java持久层框架Mybatis之上</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">Allen Xue</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">March 12, 2020&nbsp;&nbsp;0:57:46</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/category/Java-EE/">Java_EE</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <h2 id="一、框架概述"><a href="#一、框架概述" class="headerlink" title="一、框架概述"></a>一、框架概述</h2><h3 id="1、什么是框架"><a href="#1、什么是框架" class="headerlink" title="1、什么是框架"></a>1、什么是框架</h3><h4 id="（1）什么是框架"><a href="#（1）什么是框架" class="headerlink" title="（1）什么是框架"></a>（1）什么是框架</h4><p><strong>框架（Framework）</strong> <em>是整个或部分系统的可重用设计，表现为一组抽象构件及构件实例间交互的方法;另一种定义认为，框架是可被应用开发者定制的应用骨架。前者是从应用方面而后者是从目的方面给出的定义。</em></p>
<ul>
<li>简而言之，<strong>框架其实就是某种应用的半成品，就是一组组件，供你选用完成你自己的系统</strong>。<strong>简单说就是使用别人搭好的舞台，你来做表演。而且，框架一般是成熟的，不断升级的软件。</strong></li>
</ul>
<h4 id="（2）框架要解决的问题"><a href="#（2）框架要解决的问题" class="headerlink" title="（2）框架要解决的问题"></a>（2）框架要解决的问题</h4><ul>
<li><strong>框架要解决的最重要的一个问题是技术整合的问题</strong>，在J2EE的框架中，有着各种各样的技术，不同的软件企业需要从J2EE中选择不同的技术，这就使得软件企业最终的应用依赖于这些技术，技术自身的复杂性和技术的风险性将会直接对应用造成冲击。而应用是软件企业的核心，是竞争力的关键所在，因此应该将应用自身的设计和具体的实现技术解耦。这样，软件企业的研发将集中在应用的设计上，而不是具体的技术实现，技术实现是应用的底层支撑，它不应该直接对应用产生影响。</li>
<li><strong>框架一般处在低层应用平台（如J2EE）和高层业务逻辑之间的中间层。</strong></li>
</ul>
<h4 id="（3）软件开发的分层重要性"><a href="#（3）软件开发的分层重要性" class="headerlink" title="（3）软件开发的分层重要性"></a>（3）软件开发的分层重要性</h4><p><strong>框架的重要性在于它实现了部分功能，并且能够很好的将低层应用平台和高层业务逻辑进行了缓和</strong>。为了实现软件工程中的“<strong>高内聚、低耦合</strong>”。把问题划分开来各个解决，<strong>易于控制，易于延展，易于分配资源</strong>。<strong>我们常见的MVC软件设计思想就是很好的分层思想。</strong></p>
<ul>
<li><strong>通过分层更好的实现了各个部分的职责，在每一层将再细化出不同的框架，分别解决各层关注的问题</strong>。<br><img src="/2020/03/12/初识Java持久层框架Mybatis之上/1.png" alt="image"></li>
</ul>
<h4 id="（4）分层开发下的常见框架"><a href="#（4）分层开发下的常见框架" class="headerlink" title="（4）分层开发下的常见框架"></a>（4）分层开发下的常见框架</h4><h5 id="常见的JavaEE开发框架："><a href="#常见的JavaEE开发框架：" class="headerlink" title="常见的JavaEE开发框架："></a>常见的JavaEE开发框架：</h5><ul>
<li><strong>解决数据的持久化问题的框架</strong><ul>
<li><strong>Mybatis框架</strong></li>
<li><strong>封装程度更高的框架Hibernate</strong>，但这个框架因为各种原因目前在国内的流行程度下降太多，现在公司开发也越来越少使用。</li>
<li>目前使用<strong>Spring Data</strong>来实现数据持久化也是一种趋势。<br><img src="/2020/03/12/初识Java持久层框架Mybatis之上/3.png" alt="image"></li>
</ul>
</li>
<li><strong>解决WEB层问题的MVC框架</strong></li>
<li><strong>解决技术整合问题的Spring框架</strong><br><img src="/2020/03/12/初识Java持久层框架Mybatis之上/2.png" alt="image"></li>
</ul>
<h4 id="（5）MyBatis框架概述"><a href="#（5）MyBatis框架概述" class="headerlink" title="（5）MyBatis框架概述"></a>（5）MyBatis框架概述</h4><p><img src="/2020/03/12/初识Java持久层框架Mybatis之上/4.png" alt="image"></p>
<ul>
<li><strong>Mybatis是一个优秀的基于java的持久层框架</strong>，它<strong>内部封装了jdbc</strong>，使开发者<strong>只需要关注sql语句本身</strong>，而不需要花费精力去处理加载驱动、创建连接、创建 statement 等繁杂的过程。</li>
<li><strong>Mybatis通过xml或注解的方式将要执行的各种statement配置起来</strong>，并通过java对象和statement中sql的动态参数进行<strong>映射生成最终执行的sql语句</strong>，最后由Mybatis框架执行sql并<strong>将结果映射为java对象并返回</strong>。</li>
<li><strong>采用ORM思想解决了实体和数据库映射的问题，对jdbc进行了封装</strong>，屏蔽了jdbc api底层访问细节，使我们不用与jdbcapi打交道，就可以完成对数据库的持久化操作。<br><img src="/2020/03/12/初识Java持久层框架Mybatis之上/9.png" alt="image"></li>
</ul>
<h3 id="2、JDBC编程的分析"><a href="#2、JDBC编程的分析" class="headerlink" title="2、JDBC编程的分析"></a>2、JDBC编程的分析</h3><h4 id="（1）jdbc程序的回顾"><a href="#（1）jdbc程序的回顾" class="headerlink" title="（1）jdbc程序的回顾"></a>（1）jdbc程序的回顾</h4><p><strong>下边使用jdbc的原始方法（未经封装）实现了查询数据库表记录的操作：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">    Connection connection = null;</span><br><span class="line">    PreparedStatement preparedStatement = null;</span><br><span class="line">    ResultSet resultSet = null;</span><br><span class="line">    try &#123;</span><br><span class="line">        //加载数据库驱动</span><br><span class="line">        Class.forName(&quot;com.mysql.jdbc.Driver&quot;);</span><br><span class="line">        //通过驱动管理类获取数据库链接</span><br><span class="line">        connection = DriverManager.getConnection(&quot;jdbc:mysql://localhost:3306/mybatis?characterEncoding=utf-8&quot;,&quot;root&quot;, &quot;root&quot;);</span><br><span class="line">        //定义 sql 语句 ?表示占位符</span><br><span class="line">        String sql = &quot;select * from user where username = ?&quot;;</span><br><span class="line">        //获取预处理 statement</span><br><span class="line">        preparedStatement = connection.prepareStatement(sql);</span><br><span class="line">        //设置参数，第一个参数为 sql 语句中参数的序号（从 1 开始），第二个参数为设置的参数值</span><br><span class="line">        preparedStatement.setString(1, &quot;王五&quot;);</span><br><span class="line">        //向数据库发出 sql 执行查询，查询出结果集</span><br><span class="line">        resultSet = preparedStatement.executeQuery();</span><br><span class="line">        //遍历查询结果集</span><br><span class="line">        while(resultSet.next())&#123;</span><br><span class="line">            System.out.println(resultSet.getString(&quot;id&quot;)+&quot;,&quot;+resultSet.getString(&quot;username&quot;));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; catch (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;finally&#123;</span><br><span class="line">        //释放资源</span><br><span class="line">        if(resultSet!=null)&#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                resultSet.close();</span><br><span class="line">            &#125; catch (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        if(preparedStatement!=null)&#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                preparedStatement.close();</span><br><span class="line">            &#125; catch (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        if(connection!=null)&#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                connection.close();</span><br><span class="line">            &#125; catch (SQLException e) &#123;</span><br><span class="line">                // TODO Auto-generated catch block</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="（2）jdbc问题分析"><a href="#（2）jdbc问题分析" class="headerlink" title="（2）jdbc问题分析"></a>（2）jdbc问题分析</h4><ul>
<li><strong>数据库链接创建、释放频繁造成系统资源浪费从而影响系统性能</strong>，如果<strong>使用数据库链接池可解决此问题</strong>。</li>
<li><strong>Sql语句在代码中硬编码，造成代码不易维护</strong>，实际应用sql变化的可能较大，sql变动需要改变java代码。</li>
<li><strong>使用preparedStatement向占有位符号传参数存在硬编码</strong>，因为sql语句的where条件不一定，可能多也可能少，修改sql还要修改代码，系统不易维护。</li>
<li><strong>对结果集解析存在硬编码（查询列名）</strong>，sql变化导致解析代码变化，系统不易维护，<strong>如果能将数据库记<br>录封装成pojo对象解析比较方便。</strong></li>
</ul>
<h2 id="二、Mybatis框架快速入门"><a href="#二、Mybatis框架快速入门" class="headerlink" title="二、Mybatis框架快速入门"></a>二、Mybatis框架快速入门</h2><h3 id="1、Mybatis框架开发的准备"><a href="#1、Mybatis框架开发的准备" class="headerlink" title="1、Mybatis框架开发的准备"></a>1、Mybatis框架开发的准备</h3><ul>
<li><p><em>官网下载Mybatis框架</em>（如果创建JavaEE工程可以使用，一般不推荐）<a href="https://github.com/mybatis/mybatis-3/releases" target="_blank" rel="noopener">点击进入下载地址</a></p>
</li>
<li><p><strong>创建普通maven工程，不需要选择模板，在pom文件中添加下面内容即可（包含在<code>&lt;project&gt;</code>标签内）</strong>（推荐采用）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;packaging&gt;jar&lt;/packaging&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;!--Mybatis的jar包--&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.mybatis&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;mybatis&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;3.4.5&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!--连接数据库的驱动,根据自己的数据库版本进行修改--&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;8.0.18&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!--日志文件的jar包--&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;log4j&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;log4j&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;1.2.12&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!--单元测试的jar包--&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;4.10&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Mybatis开发文档</strong> <a href="https://mybatis.org/mybatis-3/" target="_blank" rel="noopener">点击进入</a><br><img src="/2020/03/12/初识Java持久层框架Mybatis之上/5.png" alt="image"></p>
</li>
</ul>
<h3 id="2、创建所需要的表"><a href="#2、创建所需要的表" class="headerlink" title="2、创建所需要的表"></a>2、创建所需要的表</h3><p><strong>sql语句</strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE javatest;</span><br><span class="line">USE javatest;</span><br><span class="line"></span><br><span class="line">DROP TABLE IF EXISTS `user`;</span><br><span class="line"></span><br><span class="line">CREATE TABLE `user` (</span><br><span class="line">  `id` int(11) NOT NULL auto_increment,</span><br><span class="line">  `username` varchar(32) NOT NULL COMMENT &apos;用户名称&apos;,</span><br><span class="line">  `birthday` datetime default NULL COMMENT &apos;生日&apos;,</span><br><span class="line">  `sex` char(1) default NULL COMMENT &apos;性别&apos;,</span><br><span class="line">  `address` varchar(256) default NULL COMMENT &apos;地址&apos;,</span><br><span class="line">  PRIMARY KEY  (`id`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">insert  into `user`(`id`,`username`,`birthday`,`sex`,`address`) values (41,&apos;老王&apos;,&apos;2018-02-27 17:47:08&apos;,&apos;男&apos;,&apos;北京&apos;),(42,&apos;小二王&apos;,&apos;2018-03-02 15:09:37&apos;,&apos;女&apos;,&apos;北京金燕龙&apos;),(43,&apos;小二王&apos;,&apos;2018-03-04 11:34:34&apos;,&apos;女&apos;,&apos;北京金燕龙&apos;),(45,&apos;传智播客&apos;,&apos;2018-03-04 12:04:06&apos;,&apos;男&apos;,&apos;北京金燕龙&apos;),(46,&apos;老王&apos;,&apos;2018-03-07 17:37:26&apos;,&apos;男&apos;,&apos;北京&apos;),(48,&apos;小马宝莉&apos;,&apos;2018-03-08 11:44:00&apos;,&apos;女&apos;,&apos;北京修正&apos;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DROP TABLE IF EXISTS `account`;</span><br><span class="line"></span><br><span class="line">CREATE TABLE `account` (</span><br><span class="line">  `ID` int(11) NOT NULL COMMENT &apos;编号&apos;,</span><br><span class="line">  `UID` int(11) default NULL COMMENT &apos;用户编号&apos;,</span><br><span class="line">  `MONEY` double default NULL COMMENT &apos;金额&apos;,</span><br><span class="line">  PRIMARY KEY  (`ID`),</span><br><span class="line">  KEY `FK_Reference_8` (`UID`),</span><br><span class="line">  CONSTRAINT `FK_Reference_8` FOREIGN KEY (`UID`) REFERENCES `user` (`id`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">insert  into `account`(`ID`,`UID`,`MONEY`) values (1,41,1000),(2,45,1000),(3,41,2000);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DROP TABLE IF EXISTS `role`;</span><br><span class="line"></span><br><span class="line">CREATE TABLE `role` (</span><br><span class="line">  `ID` int(11) NOT NULL COMMENT &apos;编号&apos;,</span><br><span class="line">  `ROLE_NAME` varchar(30) default NULL COMMENT &apos;角色名称&apos;,</span><br><span class="line">  `ROLE_DESC` varchar(60) default NULL COMMENT &apos;角色描述&apos;,</span><br><span class="line">  PRIMARY KEY  (`ID`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">insert  into `role`(`ID`,`ROLE_NAME`,`ROLE_DESC`) values (1,&apos;院长&apos;,&apos;管理整个学院&apos;),(2,&apos;总裁&apos;,&apos;管理整个公司&apos;),(3,&apos;校长&apos;,&apos;管理整个学校&apos;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DROP TABLE IF EXISTS `user_role`;</span><br><span class="line"></span><br><span class="line">CREATE TABLE `user_role` (</span><br><span class="line">  `UID` int(11) NOT NULL COMMENT &apos;用户编号&apos;,</span><br><span class="line">  `RID` int(11) NOT NULL COMMENT &apos;角色编号&apos;,</span><br><span class="line">  PRIMARY KEY  (`UID`,`RID`),</span><br><span class="line">  KEY `FK_Reference_10` (`RID`),</span><br><span class="line">  CONSTRAINT `FK_Reference_10` FOREIGN KEY (`RID`) REFERENCES `role` (`ID`),</span><br><span class="line">  CONSTRAINT `FK_Reference_9` FOREIGN KEY (`UID`) REFERENCES `user` (`id`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8;</span><br><span class="line"></span><br><span class="line">insert  into `user_role`(`UID`,`RID`) values (41,1),(45,1),(41,2);</span><br></pre></td></tr></table></figure>

<h3 id="3、编写User实体类"><a href="#3、编写User实体类" class="headerlink" title="3、编写User实体类"></a>3、编写User实体类</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">package com.allen.domain;</span><br><span class="line"></span><br><span class="line">import java.io.Serializable;</span><br><span class="line">import java.util.Date;</span><br><span class="line"></span><br><span class="line">public class User implements Serializable &#123;</span><br><span class="line"></span><br><span class="line">    private Integer id;</span><br><span class="line">    private String username;</span><br><span class="line">    private Date birthday;</span><br><span class="line">    private String sex;</span><br><span class="line">    private String address;</span><br><span class="line"></span><br><span class="line">    public Integer getId() &#123;</span><br><span class="line">        return id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setId(Integer id) &#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getUsername() &#123;</span><br><span class="line">        return username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setUsername(String username) &#123;</span><br><span class="line">        this.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Date getBirthday() &#123;</span><br><span class="line">        return birthday;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setBirthday(Date birthday) &#123;</span><br><span class="line">        this.birthday = birthday;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getSex() &#123;</span><br><span class="line">        return sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSex(String sex) &#123;</span><br><span class="line">        this.sex = sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getAddress() &#123;</span><br><span class="line">        return address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setAddress(String address) &#123;</span><br><span class="line">        this.address = address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;User&#123;&quot; +</span><br><span class="line">                &quot;id=&quot; + id +</span><br><span class="line">                &quot;, username=&apos;&quot; + username + &apos;\&apos;&apos; +</span><br><span class="line">                &quot;, birthday=&quot; + birthday +</span><br><span class="line">                &quot;, sex=&apos;&quot; + sex + &apos;\&apos;&apos; +</span><br><span class="line">                &quot;, address=&apos;&quot; + address + &apos;\&apos;&apos; +</span><br><span class="line">                &apos;&#125;&apos;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4、编写持久层接口UserDao"><a href="#4、编写持久层接口UserDao" class="headerlink" title="4、编写持久层接口UserDao"></a>4、编写持久层接口UserDao</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">package com.allen.dao;</span><br><span class="line"></span><br><span class="line">import com.allen.domain.User;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">public interface UserDao &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 查询所有</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    List&lt;User&gt; findAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5、编写持久层接口的映射文件UserDao-xml"><a href="#5、编写持久层接口的映射文件UserDao-xml" class="headerlink" title="5、编写持久层接口的映射文件UserDao.xml"></a>5、编写持久层接口的映射文件UserDao.xml</h3><ul>
<li><strong>要求</strong>：<ul>
<li><strong>创建位置</strong>：<strong>必须和持久层接口在相同的包中。</strong></li>
<li><strong>名称</strong>：<strong>必须以持久层接口名称命名文件名，扩展名是.xml</strong><br><img src="/2020/03/12/初识Java持久层框架Mybatis之上/6.png" alt="image"><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">        PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span><br><span class="line">        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line"> &lt;mapper namespace=&quot;com.allen.dao.UserDao&quot;&gt;</span><br><span class="line">    &lt;!--配置查询所有--&gt;</span><br><span class="line">    &lt;select id=&quot;findAll&quot; resultType=&quot;com.allen.domain.User&quot;&gt;</span><br><span class="line">        select * from user</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h3 id="6、编写SqlMapConfig-xml配置文件"><a href="#6、编写SqlMapConfig-xml配置文件" class="headerlink" title="6、编写SqlMapConfig.xml配置文件"></a>6、编写SqlMapConfig.xml配置文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE configuration</span><br><span class="line">        PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span><br><span class="line">        &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;</span><br><span class="line">&lt;!--mybatis的主配置文件--&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;!--配置环境--&gt;</span><br><span class="line">    &lt;environments default=&quot;mysql&quot;&gt;</span><br><span class="line">        &lt;!--配置mysql的环境--&gt;</span><br><span class="line">        &lt;environment id=&quot;mysql&quot;&gt;</span><br><span class="line">            &lt;!--配置事务的类型--&gt;</span><br><span class="line">            &lt;transactionManager type=&quot;jdbc&quot;&gt;&lt;/transactionManager&gt;</span><br><span class="line">            &lt;!--配置数据源（连接池）--&gt;</span><br><span class="line">            &lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">                &lt;!--配置连接数据库的4个基本信息--&gt;</span><br><span class="line">                &lt;property name=&quot;driver&quot; value=&quot;com.mysql.cj.jdbc.Driver&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/javatest?useSSL=false&amp;amp;serverTimezone=UTC&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;password&quot; value=&quot;991104&quot;/&gt;</span><br><span class="line">            &lt;/dataSource&gt;</span><br><span class="line">        &lt;/environment&gt;</span><br><span class="line">    &lt;/environments&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--指定映射配置文件的位置，映射配置文件指的是每个dao独立的配置文件--&gt;</span><br><span class="line">    &lt;mappers&gt;</span><br><span class="line">        &lt;mapper resource=&quot;com/allen/dao/UserDao.xml&quot;/&gt;</span><br><span class="line">    &lt;/mappers&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>

<h3 id="7、编写测试类"><a href="#7、编写测试类" class="headerlink" title="7、编写测试类"></a>7、编写测试类</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">package com.allen.test;</span><br><span class="line"></span><br><span class="line">import com.allen.dao.UserDao;</span><br><span class="line">import com.allen.domain.User;</span><br><span class="line">import org.apache.ibatis.io.Resources;</span><br><span class="line">import org.apache.ibatis.session.SqlSession;</span><br><span class="line">import org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line">import org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.InputStream;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">public class MybatisTest &#123;</span><br><span class="line">    public static void main(String[] args) throws IOException &#123;</span><br><span class="line">        //1、读取配置文件</span><br><span class="line">        InputStream in = Resources.getResourceAsStream(&quot;SqlMapConfig.xml&quot;);</span><br><span class="line">        //2、创建SqlSessionFactory工厂</span><br><span class="line">        SqlSessionFactoryBuilder builder = new SqlSessionFactoryBuilder();</span><br><span class="line">        SqlSessionFactory factory = builder.build(in);</span><br><span class="line">        //3、使用工厂生产SqlSession对象</span><br><span class="line">        SqlSession session = factory.openSession();</span><br><span class="line">        //4、使用SqlSession创建Dao接口的代理对象</span><br><span class="line">        UserDao userDao = session.getMapper(UserDao.class);</span><br><span class="line">        //5、使用代理对象执行方法</span><br><span class="line">        List&lt;User&gt; users = userDao.findAll();</span><br><span class="line">        for (User user : users) &#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line">        //6、释放资源</span><br><span class="line">        session.close();</span><br><span class="line">        in.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8、小结"><a href="#8、小结" class="headerlink" title="8、小结"></a>8、小结</h3><ul>
<li><strong>查询所有的分析</strong><br><img src="/2020/03/12/初识Java持久层框架Mybatis之上/7.png" alt="image"></li>
<li><strong>入门案例的分析</strong><br><img src="/2020/03/12/初识Java持久层框架Mybatis之上/8.png" alt="image"></li>
<li>通过快速入门示例，我们发现<strong>使用mybatis是非常容易的一件事情</strong>，因为只需要编写Dao接口并且按照Mybatis要求编写<strong>两个配置文件</strong>，就可以实现功能。远<strong>比之前的jdbc方便</strong>多了。（使用注解之后，将变得更为简单，只需要编写一个Mybatis配置文件就够了。）</li>
<li>但是，这里面包含了许多细节，比如为什么会有<strong>工厂对象（SqlSessionFactory）</strong>,为什么有了工厂之后还<br>要有<strong>构建者对象（SqlSessionFactoryBuilder）</strong>，为什么UserDao.xml在创建时有位置和文件名的要求等等。</li>
<li><strong>这些问题通过后面自己实现自定义Mybatis框架，就会有所认识</strong>。</li>
<li><em>注意：自定义Mybatis框架，不是让大家回去自己去写个 Mybatis，而是让能更好了了解Mybatis内部是怎么执行的，在以后的开发中能更好的使用Mybatis框架，同时对它的设计理念（设计模式）有一个认识。</em></li>
</ul>
<h3 id="9、补充（基于注解的-mybatis-使用）"><a href="#9、补充（基于注解的-mybatis-使用）" class="headerlink" title="9、补充（基于注解的 mybatis 使用）"></a>9、补充（基于注解的 mybatis 使用）</h3><h4 id="（1）在持久层接口中添加注解"><a href="#（1）在持久层接口中添加注解" class="headerlink" title="（1）在持久层接口中添加注解"></a>（1）在持久层接口中添加注解</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">package com.allen.dao;</span><br><span class="line"></span><br><span class="line">import com.allen.domain.User;</span><br><span class="line">import org.apache.ibatis.annotations.Select;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">public interface UserDao &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 查询所有</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    @Select(&quot;select * from user&quot;)</span><br><span class="line">    List&lt;User&gt; findAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="（2）修改SqlMapConfig-xml"><a href="#（2）修改SqlMapConfig-xml" class="headerlink" title="（2）修改SqlMapConfig.xml"></a>（2）修改SqlMapConfig.xml</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE configuration</span><br><span class="line">        PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span><br><span class="line">        &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;</span><br><span class="line">&lt;!--mybatis的主配置文件--&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;!--配置环境--&gt;</span><br><span class="line">    &lt;environments default=&quot;mysql&quot;&gt;</span><br><span class="line">        &lt;!--配置mysql的环境--&gt;</span><br><span class="line">        &lt;environment id=&quot;mysql&quot;&gt;</span><br><span class="line">            &lt;!--配置事务的类型--&gt;</span><br><span class="line">            &lt;transactionManager type=&quot;jdbc&quot;&gt;&lt;/transactionManager&gt;</span><br><span class="line">            &lt;!--配置数据源（连接池）--&gt;</span><br><span class="line">            &lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">                &lt;!--配置连接数据库的4个基本信息--&gt;</span><br><span class="line">                &lt;property name=&quot;driver&quot; value=&quot;com.mysql.cj.jdbc.Driver&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/javatest?useSSL=false&amp;amp;serverTimezone=UTC&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;password&quot; value=&quot;991104&quot;/&gt;</span><br><span class="line">            &lt;/dataSource&gt;</span><br><span class="line">        &lt;/environment&gt;</span><br><span class="line">    &lt;/environments&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--指定映射配置文件的位置，映射配置文件指的是每个dao独立的配置文件</span><br><span class="line">        如果用注解来配置的话，此处应该适应class属性指定被逐节的dao全限定类名</span><br><span class="line">    --&gt;</span><br><span class="line">    &lt;mappers&gt;</span><br><span class="line">        &lt;mapper class=&quot;com.allen.dao.UserDao&quot;/&gt;</span><br><span class="line">    &lt;/mappers&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>

<h4 id="（3）注意事项"><a href="#（3）注意事项" class="headerlink" title="（3）注意事项"></a>（3）注意事项</h4><p><strong>在使用基于注解的Mybatis配置时，先移除xml的映射配置（UserDao.xml）。</strong></p>
<h2 id="三、自定义Mybatis框架"><a href="#三、自定义Mybatis框架" class="headerlink" title="三、自定义Mybatis框架"></a>三、自定义Mybatis框架</h2><h3 id="1、自定义Mybatis框架的分析"><a href="#1、自定义Mybatis框架的分析" class="headerlink" title="1、自定义Mybatis框架的分析"></a>1、自定义Mybatis框架的分析</h3><h4 id="（1）涉及知识点介绍"><a href="#（1）涉及知识点介绍" class="headerlink" title="（1）涉及知识点介绍"></a>（1）涉及知识点介绍</h4><p><strong>下面将使用前面所学的基础知识来构建一个属于自己的持久层框架</strong>，将会涉及到的一些知识点：<strong>工厂模式（Factory 工厂模式）、构造者模式（Builder 模式）、代理模式，反射，自定义注解，注解的反射，xml 解析，数据库元数据，元数据的反射等。</strong></p>
<h4 id="（2）分析流程"><a href="#（2）分析流程" class="headerlink" title="（2）分析流程"></a>（2）分析流程</h4><p><img src="/2020/03/12/初识Java持久层框架Mybatis之上/10.png" alt="image"></p>
<h3 id="2、前期准备"><a href="#2、前期准备" class="headerlink" title="2、前期准备"></a>2、前期准备</h3><h4 id="（1）创建Maven工程"><a href="#（1）创建Maven工程" class="headerlink" title="（1）创建Maven工程"></a>（1）创建Maven工程</h4><p><img src="/2020/03/12/初识Java持久层框架Mybatis之上/11.png" alt="image"></p>
<h4 id="（2）引入相关坐标"><a href="#（2）引入相关坐标" class="headerlink" title="（2）引入相关坐标"></a>（2）引入相关坐标</h4><p><strong>在pom文件中添加下面内容即可（包含在<code>&lt;project&gt;</code>标签内）</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;packaging&gt;jar&lt;/packaging&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;!--因为是自定义mybatis所有不用导入Mybatis的jar包--&gt;</span><br><span class="line">    &lt;!--连接数据库的驱动,根据自己的数据库版本进行修改--&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;8.0.18&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!--日志文件的jar包--&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;log4j&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;log4j&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;1.2.12&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!--单元测试的jar包--&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;4.10&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>

<h4 id="（3）引入工具类到项目中"><a href="#（3）引入工具类到项目中" class="headerlink" title="（3）引入工具类到项目中"></a>（3）引入工具类到项目中</h4><p><em>该工具类为解析Xml文件的工具类，了解即可</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br></pre></td><td class="code"><pre><span class="line">package com.allen.mybatis.utils;</span><br><span class="line"></span><br><span class="line">//import com.allen.mybatis.annotations.Select;</span><br><span class="line">import com.allen.mybatis.annotation.Select;</span><br><span class="line">import com.allen.mybatis.cfg.Configuration;</span><br><span class="line">import com.allen.mybatis.cfg.Mapper;</span><br><span class="line">import com.allen.mybatis.io.Resources;</span><br><span class="line"></span><br><span class="line">import org.dom4j.Attribute;</span><br><span class="line">import org.dom4j.Document;</span><br><span class="line">import org.dom4j.Element;</span><br><span class="line">import org.dom4j.io.SAXReader;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.InputStream;</span><br><span class="line">import java.lang.reflect.Method;</span><br><span class="line">import java.lang.reflect.ParameterizedType;</span><br><span class="line">import java.lang.reflect.Type;</span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  用于解析配置文件</span><br><span class="line"> */</span><br><span class="line">public class XMLConfigBuilder &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 解析主配置文件，把里面的内容填充到DefaultSqlSession所需要的地方</span><br><span class="line">     * 使用的技术：</span><br><span class="line">     *      dom4j+xpath</span><br><span class="line">     */</span><br><span class="line">    public static Configuration loadConfiguration(InputStream config)&#123;</span><br><span class="line">        try&#123;</span><br><span class="line">            //定义封装连接信息的配置对象（mybatis的配置对象）</span><br><span class="line">            Configuration cfg = new Configuration();</span><br><span class="line"></span><br><span class="line">            //1.获取SAXReader对象</span><br><span class="line">            SAXReader reader = new SAXReader();</span><br><span class="line">            //2.根据字节输入流获取Document对象</span><br><span class="line">            Document document = reader.read(config);</span><br><span class="line">            //3.获取根节点</span><br><span class="line">            Element root = document.getRootElement();</span><br><span class="line">            //4.使用xpath中选择指定节点的方式，获取所有property节点</span><br><span class="line">            List&lt;Element&gt; propertyElements = root.selectNodes(&quot;//property&quot;);</span><br><span class="line">            //5.遍历节点</span><br><span class="line">            for(Element propertyElement : propertyElements)&#123;</span><br><span class="line">                //判断节点是连接数据库的哪部分信息</span><br><span class="line">                //取出name属性的值</span><br><span class="line">                String name = propertyElement.attributeValue(&quot;name&quot;);</span><br><span class="line">                if(&quot;driver&quot;.equals(name))&#123;</span><br><span class="line">                    //表示驱动</span><br><span class="line">                    //获取property标签value属性的值</span><br><span class="line">                    String driver = propertyElement.attributeValue(&quot;value&quot;);</span><br><span class="line">                    cfg.setDriver(driver);</span><br><span class="line">                &#125;</span><br><span class="line">                if(&quot;url&quot;.equals(name))&#123;</span><br><span class="line">                    //表示连接字符串</span><br><span class="line">                    //获取property标签value属性的值</span><br><span class="line">                    String url = propertyElement.attributeValue(&quot;value&quot;);</span><br><span class="line">                    cfg.setUrl(url);</span><br><span class="line">                &#125;</span><br><span class="line">                if(&quot;username&quot;.equals(name))&#123;</span><br><span class="line">                    //表示用户名</span><br><span class="line">                    //获取property标签value属性的值</span><br><span class="line">                    String username = propertyElement.attributeValue(&quot;value&quot;);</span><br><span class="line">                    cfg.setUsername(username);</span><br><span class="line">                &#125;</span><br><span class="line">                if(&quot;password&quot;.equals(name))&#123;</span><br><span class="line">                    //表示密码</span><br><span class="line">                    //获取property标签value属性的值</span><br><span class="line">                    String password = propertyElement.attributeValue(&quot;value&quot;);</span><br><span class="line">                    cfg.setPassword(password);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            //取出mappers中的所有mapper标签，判断他们使用了resource还是class属性</span><br><span class="line">            List&lt;Element&gt; mapperElements = root.selectNodes(&quot;//mappers/mapper&quot;);</span><br><span class="line">            //遍历集合</span><br><span class="line">            for(Element mapperElement : mapperElements)&#123;</span><br><span class="line">                //判断mapperElement使用的是哪个属性</span><br><span class="line">                Attribute attribute = mapperElement.attribute(&quot;resource&quot;);</span><br><span class="line">                if(attribute != null)&#123;</span><br><span class="line">                    System.out.println(&quot;使用的是XML&quot;);</span><br><span class="line">                    //表示有resource属性，用的是XML</span><br><span class="line">                    //取出属性的值</span><br><span class="line">                    String mapperPath = attribute.getValue();//获取属性的值&quot;com/allen/dao/UserDao.xml&quot;</span><br><span class="line">                    //把映射配置文件的内容获取出来，封装成一个map</span><br><span class="line">                    Map&lt;String, Mapper&gt; mappers = loadMapperConfiguration(mapperPath);</span><br><span class="line">                    //给configuration中的mappers赋值</span><br><span class="line">                    cfg.setMappers(mappers);</span><br><span class="line">                &#125;else&#123;</span><br><span class="line">                    System.out.println(&quot;使用的是注解&quot;);</span><br><span class="line">                    //表示没有resource属性，用的是注解</span><br><span class="line">                    //获取class属性的值</span><br><span class="line">                    String daoClassPath = mapperElement.attributeValue(&quot;class&quot;);</span><br><span class="line">                    //根据daoClassPath获取封装的必要信息</span><br><span class="line">                    Map&lt;String,Mapper&gt; mappers = loadMapperAnnotation(daoClassPath);</span><br><span class="line">                    //给configuration中的mappers赋值</span><br><span class="line">                    cfg.setMappers(mappers);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            //返回Configuration</span><br><span class="line">            return cfg;</span><br><span class="line">        &#125;catch(Exception e)&#123;</span><br><span class="line">            throw new RuntimeException(e);</span><br><span class="line">        &#125;finally&#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                config.close();</span><br><span class="line">            &#125;catch(Exception e)&#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据传入的参数，解析XML，并且封装到Map中</span><br><span class="line">     * @param mapperPath    映射配置文件的位置</span><br><span class="line">     * @return  map中包含了获取的唯一标识（key是由dao的全限定类名和方法名组成）</span><br><span class="line">     *          以及执行所需的必要信息（value是一个Mapper对象，里面存放的是执行的SQL语句和要封装的实体类全限定类名）</span><br><span class="line">     */</span><br><span class="line">    private static Map&lt;String,Mapper&gt; loadMapperConfiguration(String mapperPath)throws IOException &#123;</span><br><span class="line">        InputStream in = null;</span><br><span class="line">        try&#123;</span><br><span class="line">            //定义返回值对象</span><br><span class="line">            Map&lt;String,Mapper&gt; mappers = new HashMap&lt;String,Mapper&gt;();</span><br><span class="line">            //1.根据路径获取字节输入流</span><br><span class="line">            in = Resources.getResourceAsStream(mapperPath);</span><br><span class="line">            //2.根据字节输入流获取Document对象</span><br><span class="line">            SAXReader reader = new SAXReader();</span><br><span class="line">            Document document = reader.read(in);</span><br><span class="line">            //3.获取根节点</span><br><span class="line">            Element root = document.getRootElement();</span><br><span class="line">            //4.获取根节点的namespace属性取值</span><br><span class="line">            String namespace = root.attributeValue(&quot;namespace&quot;);//是组成map中key的部分</span><br><span class="line">            //5.获取所有的select节点</span><br><span class="line">            List&lt;Element&gt; selectElements = root.selectNodes(&quot;//select&quot;);</span><br><span class="line">            //6.遍历select节点集合</span><br><span class="line">            for(Element selectElement : selectElements)&#123;</span><br><span class="line">                //取出id属性的值      组成map中key的部分</span><br><span class="line">                String id = selectElement.attributeValue(&quot;id&quot;);</span><br><span class="line">                //取出resultType属性的值  组成map中value的部分</span><br><span class="line">                String resultType = selectElement.attributeValue(&quot;resultType&quot;);</span><br><span class="line">                //取出文本内容            组成map中value的部分</span><br><span class="line">                String queryString = selectElement.getText();</span><br><span class="line">                //创建Key</span><br><span class="line">                String key = namespace+&quot;.&quot;+id;</span><br><span class="line">                //创建Value</span><br><span class="line">                Mapper mapper = new Mapper();</span><br><span class="line">                mapper.setQueryString(queryString);</span><br><span class="line">                mapper.setResultType(resultType);</span><br><span class="line">                //把key和value存入mappers中</span><br><span class="line">                mappers.put(key,mapper);</span><br><span class="line">            &#125;</span><br><span class="line">            return mappers;</span><br><span class="line">        &#125;catch(Exception e)&#123;</span><br><span class="line">            throw new RuntimeException(e);</span><br><span class="line">        &#125;finally&#123;</span><br><span class="line">            in.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据传入的参数，得到dao中所有被select注解标注的方法。</span><br><span class="line">     * 根据方法名称和类名，以及方法上注解value属性的值，组成Mapper的必要信息</span><br><span class="line">     * @param daoClassPath</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    private static Map&lt;String,Mapper&gt; loadMapperAnnotation(String daoClassPath)throws Exception&#123;</span><br><span class="line">        //定义返回值对象</span><br><span class="line">        Map&lt;String,Mapper&gt; mappers = new HashMap&lt;String, Mapper&gt;();</span><br><span class="line"></span><br><span class="line">        //1.得到dao接口的字节码对象</span><br><span class="line">        Class daoClass = Class.forName(daoClassPath);</span><br><span class="line">        //2.得到dao接口中的方法数组</span><br><span class="line">        Method[] methods = daoClass.getMethods();</span><br><span class="line">        //3.遍历Method数组</span><br><span class="line">        for(Method method : methods)&#123;</span><br><span class="line">            //取出每一个方法，判断是否有select注解</span><br><span class="line">            boolean isAnnotated = method.isAnnotationPresent(Select.class);</span><br><span class="line">            if(isAnnotated)&#123;</span><br><span class="line">                //创建Mapper对象</span><br><span class="line">                Mapper mapper = new Mapper();</span><br><span class="line">                //取出注解的value属性值</span><br><span class="line">                Select selectAnno = method.getAnnotation(Select.class);</span><br><span class="line">                String queryString = selectAnno.value();</span><br><span class="line">                mapper.setQueryString(queryString);</span><br><span class="line">                //获取当前方法的返回值，还要求必须带有泛型信息</span><br><span class="line">                Type type = method.getGenericReturnType();//List&lt;User&gt;</span><br><span class="line">                //判断type是不是参数化的类型</span><br><span class="line">                if(type instanceof ParameterizedType)&#123;</span><br><span class="line">                    //强转</span><br><span class="line">                    ParameterizedType ptype = (ParameterizedType)type;</span><br><span class="line">                    //得到参数化类型中的实际类型参数</span><br><span class="line">                    Type[] types = ptype.getActualTypeArguments();</span><br><span class="line">                    //取出第一个</span><br><span class="line">                    Class domainClass = (Class)types[0];</span><br><span class="line">                    //获取domainClass的类名</span><br><span class="line">                    String resultType = domainClass.getName();</span><br><span class="line">                    //给Mapper赋值</span><br><span class="line">                    mapper.setResultType(resultType);</span><br><span class="line">                &#125;</span><br><span class="line">                //组装key的信息</span><br><span class="line">                //获取方法的名称</span><br><span class="line">                String methodName = method.getName();</span><br><span class="line">                String className = method.getDeclaringClass().getName();</span><br><span class="line">                String key = className+&quot;.&quot;+methodName;</span><br><span class="line">                //给map赋值</span><br><span class="line">                mappers.put(key,mapper);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return mappers;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="（4）编写SqlMapConfig-xml"><a href="#（4）编写SqlMapConfig-xml" class="headerlink" title="（4）编写SqlMapConfig.xml"></a>（4）编写SqlMapConfig.xml</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!--mybatis的主配置文件--&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;!--配置环境--&gt;</span><br><span class="line">    &lt;environments default=&quot;mysql&quot;&gt;</span><br><span class="line">        &lt;!--配置mysql的环境--&gt;</span><br><span class="line">        &lt;environment id=&quot;mysql&quot;&gt;</span><br><span class="line">            &lt;!--配置事务的类型--&gt;</span><br><span class="line">            &lt;transactionManager type=&quot;jdbc&quot;&gt;&lt;/transactionManager&gt;</span><br><span class="line">            &lt;!--配置数据源（连接池）--&gt;</span><br><span class="line">            &lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">                &lt;!--配置连接数据库的4个基本信息--&gt;</span><br><span class="line">                &lt;property name=&quot;driver&quot; value=&quot;com.mysql.cj.jdbc.Driver&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/javatest?useSSL=false&amp;amp;serverTimezone=UTC&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;password&quot; value=&quot;991104&quot;/&gt;</span><br><span class="line">            &lt;/dataSource&gt;</span><br><span class="line">        &lt;/environment&gt;</span><br><span class="line">    &lt;/environments&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--指定映射配置文件的位置，映射配置文件指的是每个dao独立的配置文件--&gt;</span><br><span class="line">    &lt;mappers&gt;</span><br><span class="line">        &lt;mapper resource=&quot;com/allen/dao/UserDao.xml&quot;/&gt;</span><br><span class="line">    &lt;/mappers&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>注意</strong>：</li>
<li><em>此处我们直接使用的是mybatis的配置文件，但是由于我们没有使用mybatis的jar包，所以要把配置文件的约束删掉否则会报错（如果电脑能接入互联网，不删也行）*</em></li>
</ul>
<h4 id="（5）编写读取配置文件类"><a href="#（5）编写读取配置文件类" class="headerlink" title="（5）编写读取配置文件类"></a>（5）编写读取配置文件类</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">package com.allen.mybatis.io;</span><br><span class="line"></span><br><span class="line">import java.io.InputStream;</span><br><span class="line"></span><br><span class="line">public class Resources &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 根据传入的参数，获得一个字节输入流</span><br><span class="line">     * @param filePath</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public static InputStream getResourceAsStream(String filePath)&#123;</span><br><span class="line">        return Resources.class.getClassLoader().getResourceAsStream(filePath);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="（6）编写Mapper类"><a href="#（6）编写Mapper类" class="headerlink" title="（6）编写Mapper类"></a>（6）编写Mapper类</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">package com.allen.mybatis.cfg;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 用于封装执行的SQL语句和结果类型的全限定类名</span><br><span class="line"> */</span><br><span class="line">public class Mapper &#123;</span><br><span class="line"></span><br><span class="line">    private String queryString;//SQL</span><br><span class="line">    private String resultType;//实体类的全限定类名</span><br><span class="line"></span><br><span class="line">    public String getQueryString() &#123;</span><br><span class="line">        return queryString;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setQueryString(String queryString) &#123;</span><br><span class="line">        this.queryString = queryString;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getResultType() &#123;</span><br><span class="line">        return resultType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setResultType(String resultType) &#123;</span><br><span class="line">        this.resultType = resultType;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="（7）编写Configuration配置类"><a href="#（7）编写Configuration配置类" class="headerlink" title="（7）编写Configuration配置类"></a>（7）编写Configuration配置类</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">package com.allen.mybatis.cfg;</span><br><span class="line"></span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">public class Configuration &#123;</span><br><span class="line"></span><br><span class="line">    private String driver;</span><br><span class="line">    private String url;</span><br><span class="line">    private String username;</span><br><span class="line">    private String password;</span><br><span class="line"></span><br><span class="line">    private Map&lt;String,Mapper&gt; mappers = new HashMap&lt;String, Mapper&gt;();</span><br><span class="line"></span><br><span class="line">    public Map&lt;String, Mapper&gt; getMappers() &#123;</span><br><span class="line">        return mappers;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setMappers(Map&lt;String, Mapper&gt; mappers) &#123;</span><br><span class="line">        this.mappers.putAll(mappers);//此处需要使用追加的方式</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getDriver() &#123;</span><br><span class="line">        return driver;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setDriver(String driver) &#123;</span><br><span class="line">        this.driver = driver;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getUrl() &#123;</span><br><span class="line">        return url;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setUrl(String url) &#123;</span><br><span class="line">        this.url = url;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getUsername() &#123;</span><br><span class="line">        return username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setUsername(String username) &#123;</span><br><span class="line">        this.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getPassword() &#123;</span><br><span class="line">        return password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setPassword(String password) &#123;</span><br><span class="line">        this.password = password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="（8）编写User实体类"><a href="#（8）编写User实体类" class="headerlink" title="（8）编写User实体类"></a>（8）编写User实体类</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">package com.allen.domain;</span><br><span class="line"></span><br><span class="line">import java.io.Serializable;</span><br><span class="line">import java.util.Date;</span><br><span class="line"></span><br><span class="line">public class User implements Serializable &#123;</span><br><span class="line"></span><br><span class="line">    private Integer id;</span><br><span class="line">    private String username;</span><br><span class="line">    private Date birthday;</span><br><span class="line">    private String sex;</span><br><span class="line">    private String address;</span><br><span class="line"></span><br><span class="line">    public Integer getId() &#123;</span><br><span class="line">        return id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setId(Integer id) &#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getUsername() &#123;</span><br><span class="line">        return username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setUsername(String username) &#123;</span><br><span class="line">        this.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Date getBirthday() &#123;</span><br><span class="line">        return birthday;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setBirthday(Date birthday) &#123;</span><br><span class="line">        this.birthday = birthday;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getSex() &#123;</span><br><span class="line">        return sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSex(String sex) &#123;</span><br><span class="line">        this.sex = sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getAddress() &#123;</span><br><span class="line">        return address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setAddress(String address) &#123;</span><br><span class="line">        this.address = address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;User&#123;&quot; +</span><br><span class="line">                &quot;id=&quot; + id +</span><br><span class="line">                &quot;, username=&apos;&quot; + username + &apos;\&apos;&apos; +</span><br><span class="line">                &quot;, birthday=&quot; + birthday +</span><br><span class="line">                &quot;, sex=&apos;&quot; + sex + &apos;\&apos;&apos; +</span><br><span class="line">                &quot;, address=&apos;&quot; + address + &apos;\&apos;&apos; +</span><br><span class="line">                &apos;&#125;&apos;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3、基于XML的自定义mybatis框架"><a href="#3、基于XML的自定义mybatis框架" class="headerlink" title="3、基于XML的自定义mybatis框架"></a>3、基于XML的自定义mybatis框架</h3><h4 id="（1）编写持久层接口和UserDao-xml"><a href="#（1）编写持久层接口和UserDao-xml" class="headerlink" title="（1）编写持久层接口和UserDao.xml"></a>（1）编写持久层接口和UserDao.xml</h4><ul>
<li><p>持久层接口UserDao</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">package com.allen.dao;</span><br><span class="line"></span><br><span class="line">import com.allen.domain.User;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">public interface UserDao &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 查询所有</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    List&lt;User&gt; findAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>UserDao.xml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line"> &lt;mapper namespace=&quot;com.allen.dao.UserDao&quot;&gt;</span><br><span class="line">    &lt;!--配置查询所有--&gt;</span><br><span class="line">    &lt;select id=&quot;findAll&quot; resultType=&quot;com.allen.domain.User&quot;&gt;</span><br><span class="line">        select * from user</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="（2）编写构建者类"><a href="#（2）编写构建者类" class="headerlink" title="（2）编写构建者类"></a>（2）编写构建者类</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">package com.allen.mybatis.sqlsession;</span><br><span class="line"></span><br><span class="line">import com.allen.mybatis.cfg.Configuration;</span><br><span class="line">import com.allen.mybatis.sqlsession.defaults.DefaultSqlSessionFactory;</span><br><span class="line">import com.allen.mybatis.utils.XMLConfigBuilder;</span><br><span class="line"></span><br><span class="line">import java.io.InputStream;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 用于创建SqlSessionFactory对象</span><br><span class="line"> */</span><br><span class="line">public class SqlSessionFactoryBuilder &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 根据参数的字节输入流构建一个SqlSessionFactory工厂</span><br><span class="line">     * @param in</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public SqlSessionFactory build(InputStream in)&#123;</span><br><span class="line">        Configuration cfg = XMLConfigBuilder.loadConfiguration(in);</span><br><span class="line">        return new DefaultSqlSessionFactory(cfg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="（3）编写SqlSessionFactory接口和实现类"><a href="#（3）编写SqlSessionFactory接口和实现类" class="headerlink" title="（3）编写SqlSessionFactory接口和实现类"></a>（3）编写SqlSessionFactory接口和实现类</h4><ul>
<li><p>SqlSessionFactory接口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">package com.allen.mybatis.sqlsession;</span><br><span class="line"></span><br><span class="line">public interface SqlSessionFactory &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 用户打开一个新的SqlSession对象</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    SqlSession openSession();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>实现类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">package com.allen.mybatis.sqlsession.defaults;</span><br><span class="line"></span><br><span class="line">import com.allen.mybatis.cfg.Configuration;</span><br><span class="line">import com.allen.mybatis.sqlsession.SqlSession;</span><br><span class="line">import com.allen.mybatis.sqlsession.SqlSessionFactory;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * SqlSessionFactory接口的实现类</span><br><span class="line"> */</span><br><span class="line">public class DefaultSqlSessionFactory implements SqlSessionFactory &#123;</span><br><span class="line">    private Configuration cfg;</span><br><span class="line"></span><br><span class="line">    public DefaultSqlSessionFactory(Configuration cfg)&#123;</span><br><span class="line">        this.cfg = cfg;</span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">     * 用于创建一个新的操作数据库对象</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public SqlSession openSession() &#123;</span><br><span class="line">        return new DefaultSqlSession(cfg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="（4）编写SqlSession接口和实现类"><a href="#（4）编写SqlSession接口和实现类" class="headerlink" title="（4）编写SqlSession接口和实现类"></a>（4）编写SqlSession接口和实现类</h4><ul>
<li><p>SqlSession接口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">package com.allen.mybatis.sqlsession;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 自定义Mybatis中和数据库交互的核心类</span><br><span class="line"> * 它里面可以创建dao接口的代理对象</span><br><span class="line"> */</span><br><span class="line">public interface SqlSession &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 根据参数创建一个代理对象</span><br><span class="line">     * @param daoInterfaceClass dao的接口字节码</span><br><span class="line">     * @param &lt;T&gt;</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    &lt;T&gt; T getMapper(Class&lt;T&gt; daoInterfaceClass);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 释放资源</span><br><span class="line">     */</span><br><span class="line">    void  close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>实现类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">package com.allen.mybatis.sqlsession.defaults;</span><br><span class="line"></span><br><span class="line">import com.allen.mybatis.cfg.Configuration;</span><br><span class="line">import com.allen.mybatis.sqlsession.SqlSession;</span><br><span class="line">import com.allen.mybatis.sqlsession.proxy.MapperProxy;</span><br><span class="line">import com.allen.mybatis.utils.DataSourceUtil;</span><br><span class="line"></span><br><span class="line">import java.lang.reflect.Proxy;</span><br><span class="line">import java.sql.Connection;</span><br><span class="line">import java.sql.SQLException;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * SqlSession接口的实现类</span><br><span class="line"> */</span><br><span class="line">public class DefaultSqlSession implements SqlSession &#123;</span><br><span class="line"></span><br><span class="line">    private Configuration cfg;</span><br><span class="line">    private Connection conn;</span><br><span class="line">    public DefaultSqlSession(Configuration cfg)&#123;</span><br><span class="line">        this.cfg = cfg;</span><br><span class="line">        conn = DataSourceUtil.getConnection(cfg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 用户创建代理对象</span><br><span class="line">     * @param daoInterfaceClass dao的接口字节码</span><br><span class="line">     * @param &lt;T&gt;</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public &lt;T&gt; T getMapper(Class&lt;T&gt; daoInterfaceClass) &#123;</span><br><span class="line">        return (T) Proxy.newProxyInstance(daoInterfaceClass.getClassLoader(),</span><br><span class="line">                new Class[]&#123;daoInterfaceClass&#125;,new MapperProxy(cfg.getMappers(),conn));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 用于释放资源</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public void close() &#123;</span><br><span class="line">        if (conn != null)&#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                conn.close();</span><br><span class="line">            &#125; catch (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="（5）编写用于创建Dao接口代理对象的类"><a href="#（5）编写用于创建Dao接口代理对象的类" class="headerlink" title="（5）编写用于创建Dao接口代理对象的类"></a>（5）编写用于创建Dao接口代理对象的类</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">package com.allen.mybatis.sqlsession.proxy;</span><br><span class="line"></span><br><span class="line">import com.allen.mybatis.cfg.Mapper;</span><br><span class="line">import com.allen.mybatis.utils.Executor;</span><br><span class="line"></span><br><span class="line">import java.lang.reflect.InvocationHandler;</span><br><span class="line">import java.lang.reflect.Method;</span><br><span class="line">import java.sql.Connection;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">public class MapperProxy implements InvocationHandler &#123;</span><br><span class="line">    //map的key是全限定类名+方法名</span><br><span class="line">    private Map&lt;String, Mapper&gt; mappers;</span><br><span class="line">    private Connection conn;</span><br><span class="line">    public MapperProxy(Map&lt;String,Mapper&gt; mappers,Connection conn)&#123;</span><br><span class="line">        this.mappers = mappers;</span><br><span class="line">        this.conn = conn;</span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">     *用于对方法进行增强的，我们的增强其实就是调用selectList方法</span><br><span class="line">     * @param proxy</span><br><span class="line">     * @param method</span><br><span class="line">     * @param args</span><br><span class="line">     * @return</span><br><span class="line">     * @throws Throwable</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123;</span><br><span class="line">        //1、获取方法名</span><br><span class="line">        String methodName = method.getName();</span><br><span class="line">        //2、获取方法所在类的名称</span><br><span class="line">        String className = method.getDeclaringClass().getName();</span><br><span class="line">        //3、组合key</span><br><span class="line">        String key = className + &quot;.&quot; + methodName;</span><br><span class="line">        //4、获取mappers中的Mapper对象</span><br><span class="line">        Mapper mapper = mappers.get(key);</span><br><span class="line">        //5、判断是否有mapper</span><br><span class="line">        if(mapper == null)&#123;</span><br><span class="line">            throw new IllegalAccessException(&quot;传入的参数有误&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        //6、调用工具类执行查询所有</span><br><span class="line">        return new Executor().selectList(mapper,conn);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="（6）运行测试类"><a href="#（6）运行测试类" class="headerlink" title="（6）运行测试类"></a>（6）运行测试类</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">package com.allen.test;</span><br><span class="line"></span><br><span class="line">import com.allen.dao.UserDao;</span><br><span class="line">import com.allen.domain.User;</span><br><span class="line">import com.allen.mybatis.io.Resources;</span><br><span class="line">import com.allen.mybatis.sqlsession.SqlSession;</span><br><span class="line">import com.allen.mybatis.sqlsession.SqlSessionFactory;</span><br><span class="line">import com.allen.mybatis.sqlsession.SqlSessionFactoryBuilder;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.InputStream;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">public class MybatisTest &#123;</span><br><span class="line">    public static void main(String[] args) throws IOException &#123;</span><br><span class="line">        //1、读取配置文件</span><br><span class="line">        InputStream in = Resources.getResourceAsStream(&quot;SqlMapConfig.xml&quot;);</span><br><span class="line">        //2、创建SqlSessionFactory工厂</span><br><span class="line">        SqlSessionFactoryBuilder builder = new SqlSessionFactoryBuilder();</span><br><span class="line">        SqlSessionFactory factory = builder.build(in);</span><br><span class="line">        //3、使用工厂生产SqlSession对象</span><br><span class="line">        SqlSession session = factory.openSession();</span><br><span class="line">        //4、使用SqlSession创建Dao接口的代理对象</span><br><span class="line">        UserDao userDao = session.getMapper(UserDao.class);</span><br><span class="line">        //5、使用代理对象执行方法</span><br><span class="line">        List&lt;User&gt; users = userDao.findAll();</span><br><span class="line">        for (User user : users) &#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line">        //6、释放资源</span><br><span class="line">        session.close();</span><br><span class="line">        in.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4、基于注解方式定义Mybatis框架"><a href="#4、基于注解方式定义Mybatis框架" class="headerlink" title="4、基于注解方式定义Mybatis框架"></a>4、基于注解方式定义Mybatis框架</h3><h4 id="（1）自定义-Select注解"><a href="#（1）自定义-Select注解" class="headerlink" title="（1）自定义@Select注解"></a>（1）自定义@Select注解</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">package com.allen.mybatis.annotation;</span><br><span class="line"></span><br><span class="line">import java.lang.annotation.ElementType;</span><br><span class="line">import java.lang.annotation.Retention;</span><br><span class="line">import java.lang.annotation.RetentionPolicy;</span><br><span class="line">import java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 查询的注解</span><br><span class="line"> */</span><br><span class="line">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="line">@Target(ElementType.METHOD)</span><br><span class="line">public @interface Select &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 配置SQL语句的</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    String value();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="（2）修改持久层接口"><a href="#（2）修改持久层接口" class="headerlink" title="（2）修改持久层接口"></a>（2）修改持久层接口</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">package com.allen.dao;</span><br><span class="line"></span><br><span class="line">import com.allen.domain.User;</span><br><span class="line">import com.allen.mybatis.annotation.Select;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line">public interface UserDao &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 查询所有</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    @Select(&quot;select * from user&quot;)</span><br><span class="line">    List&lt;User&gt; findAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="（3）修改-SqlMapConfig-xml"><a href="#（3）修改-SqlMapConfig-xml" class="headerlink" title="（3）修改 SqlMapConfig.xml"></a>（3）修改 SqlMapConfig.xml</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!--mybatis的主配置文件--&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;!--配置环境--&gt;</span><br><span class="line">    &lt;environments default=&quot;mysql&quot;&gt;</span><br><span class="line">        &lt;!--配置mysql的环境--&gt;</span><br><span class="line">        &lt;environment id=&quot;mysql&quot;&gt;</span><br><span class="line">            &lt;!--配置事务的类型--&gt;</span><br><span class="line">            &lt;transactionManager type=&quot;jdbc&quot;&gt;&lt;/transactionManager&gt;</span><br><span class="line">            &lt;!--配置数据源（连接池）--&gt;</span><br><span class="line">            &lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">                &lt;!--配置连接数据库的4个基本信息--&gt;</span><br><span class="line">                &lt;property name=&quot;driver&quot; value=&quot;com.mysql.cj.jdbc.Driver&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/javatest?useSSL=false&amp;amp;serverTimezone=UTC&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;password&quot; value=&quot;991104&quot;/&gt;</span><br><span class="line">            &lt;/dataSource&gt;</span><br><span class="line">        &lt;/environment&gt;</span><br><span class="line">    &lt;/environments&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--指定映射配置文件的位置，映射配置文件指的是每个dao独立的配置文件--&gt;</span><br><span class="line">    &lt;mappers&gt;</span><br><span class="line">        &lt;!--&lt;mapper resource=&quot;com/allen/dao/UserDao.xml&quot;/&gt;--&gt;</span><br><span class="line">        &lt;mapper class=&quot;com.allen.dao.UserDao&quot;/&gt;</span><br><span class="line">    &lt;/mappers&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>

<h3 id="5、自定义Mybatis的设计模式说明"><a href="#5、自定义Mybatis的设计模式说明" class="headerlink" title="5、自定义Mybatis的设计模式说明"></a>5、自定义Mybatis的设计模式说明</h3><h4 id="（1）工厂模式（SqlSessionFactory）"><a href="#（1）工厂模式（SqlSessionFactory）" class="headerlink" title="（1）工厂模式（SqlSessionFactory）"></a>（1）工厂模式（SqlSessionFactory）</h4><p>工厂模式是我们最常用的实例化对象模式了，是<strong>用工厂方法代替new操作的一种模式</strong>。著名的Jive论坛 ,就大量使用了工厂模式，<strong>工厂模式在Java程序系统可以说是随处可见。因为工厂模式就相当于创建实例对象的new，我们经常要根据类Class生成实例对象，如A a=new A() 工厂模式也是用来创建实例对象的</strong>，所以以后new时就要多个心眼，是否可以考虑使用工厂模式，虽然这样做，可能多做一些工作，但会给你系统带来更大的可扩展性和尽量少的修改量。</p>
<h4 id="（2）代理模式-MapperProxy"><a href="#（2）代理模式-MapperProxy" class="headerlink" title="（2）代理模式(MapperProxy)"></a>（2）代理模式(MapperProxy)</h4><ul>
<li><strong>代理模式分为静态和动态代理</strong>。静态代理，我们通常都很熟悉。有一个写好的代理类，实现与要代理的类的一个共同的接口，目的是<strong>为了约束也为了安全</strong>。</li>
<li>这里主要想说的是关于动态代理。我们知道静态代理若想代理多个类，实现扩展功能，那么它必须具有多个代理类分别取代理不同的实现类。这样做的后果是造成太多的<strong>代码冗余</strong>。那么我们会思考如果做，才能既满足需求，又没有太多的冗余代码呢？<strong>动态代理</strong>。</li>
</ul>
<h4 id="（3）构建者模式-SqlSessionFactoryBuilder"><a href="#（3）构建者模式-SqlSessionFactoryBuilder" class="headerlink" title="（3）构建者模式(SqlSessionFactoryBuilder)"></a>（3）构建者模式(SqlSessionFactoryBuilder)</h4><p><img src="/2020/03/12/初识Java持久层框架Mybatis之上/12.png" alt="image"><br>从图中我们可以看出，<strong>创建者模式由四部分组成</strong>。</p>
<ul>
<li><strong>抽象创建者角色</strong>：给出一个抽象接口，以规范产品对象的各个组成成分的建造。一般而言，此接口独立于应用程序的商业逻辑。模式中直接创建产品对象的是具体创建者角色。具体创建者必须实现这个接口的两种方法：一是建造方法，比如图中的buildPart1和buildPart2方法；另一种是结果返回方法，即图中的getProduct方法。一般来说，产品所包含的零件数目与建造方法的数目相符。换言之，有多少零件，就有多少相应的建造方法。</li>
<li><strong>具体创建者角色</strong>：他们在应用程序中负责创建产品的实例。这个角色要完成的任务包括：<ul>
<li>实现抽象创建者所声明的抽象方法，给出一步一步的完成产品创建实例的操作。</li>
<li>在创建完成后，提供产品的实例。</li>
</ul>
</li>
<li><strong>导演者角色</strong>：这个类调用具体创建者角色以创建产品对象。但是导演者并没有产品类的具体知识，真正拥有产<br>品类的具体知识的是具体创建者角色。</li>
<li><strong>产品角色</strong>：产品便是建造中的复杂对象。一般说来，一个系统中会有多于一个的产品类，而且这些产品类并不<br>一定有共同的接口，而完全可以使不相关联的。</li>
</ul>
<h3 id="6、总结"><a href="#6、总结" class="headerlink" title="6、总结"></a>6、总结</h3><p><img src="/2020/03/12/初识Java持久层框架Mybatis之上/13.png" alt="image"></p>
<h2 id="四、基于代理Dao实现CRUD操作"><a href="#四、基于代理Dao实现CRUD操作" class="headerlink" title="四、基于代理Dao实现CRUD操作"></a>四、基于代理Dao实现CRUD操作</h2><h3 id="1、Mybatis环境搭建步骤"><a href="#1、Mybatis环境搭建步骤" class="headerlink" title="1、Mybatis环境搭建步骤"></a>1、Mybatis环境搭建步骤</h3><ul>
<li><strong>第一步：创建maven工程</strong></li>
<li><strong>第二步：导入坐标</strong></li>
<li><strong>第三步：编写必要代码（实体类和持久层接口）</strong></li>
<li><strong>第四步：编写SqlMapConfig.xml</strong></li>
<li><strong>第五步：编写映射配置文件</strong></li>
<li><strong>第六步：编写测试类</strong></li>
</ul>
<h3 id="2、根据ID查询"><a href="#2、根据ID查询" class="headerlink" title="2、根据ID查询"></a>2、根据ID查询</h3><h4 id="（1）在持久层接口中添加findById方法"><a href="#（1）在持久层接口中添加findById方法" class="headerlink" title="（1）在持久层接口中添加findById方法"></a>（1）在持久层接口中添加findById方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">* 根据 id 查询</span><br><span class="line">* @param userId</span><br><span class="line">* @return</span><br><span class="line">*/</span><br><span class="line">User findById(Integer userId);</span><br></pre></td></tr></table></figure>

<h4 id="（2）在用户的映射配置文件中配置"><a href="#（2）在用户的映射配置文件中配置" class="headerlink" title="（2）在用户的映射配置文件中配置"></a>（2）在用户的映射配置文件中配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 根据 id 查询 --&gt;</span><br><span class="line">&lt;select id=&quot;findById&quot; resultType=&quot;com.allen.domain.User&quot; parameterType=&quot;int&quot;&gt;</span><br><span class="line">    select * from user where id = #&#123;uid&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<p><strong>细节：</strong></p>
<ul>
<li><strong>resultType属性</strong>：用于指定<strong>结果集</strong>的类型。</li>
<li><strong>parameterType属性</strong>：用于指定<strong>传入参数</strong>的类型。</li>
<li><strong>sql语句中使用#{}字符</strong>：它代表<strong>占位符</strong>，相当于原来jdbc部分所学的?，都是用于执行语句时替换实际的数据。<strong>具体的数据是由#{}里面的内容决定的。</strong></li>
<li><strong>#{}中内容的写法</strong>：由于数据类型是<strong>基本类型，所以此处可以随意写</strong>。</li>
</ul>
<h4 id="（3）在测试类添加测试"><a href="#（3）在测试类添加测试" class="headerlink" title="（3）在测试类添加测试"></a>（3）在测试类添加测试</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">public class MybastisCRUDTest &#123;</span><br><span class="line">    private InputStream in ;</span><br><span class="line">    private SqlSessionFactory factory;</span><br><span class="line">    private SqlSession session;</span><br><span class="line">    private UserDao userDao;</span><br><span class="line">    </span><br><span class="line">    @Before//在测试方法执行之前执行</span><br><span class="line">    public void init()throws Exception &#123;</span><br><span class="line">        //1.读取配置文件</span><br><span class="line">        in = Resources.getResourceAsStream(&quot;SqlMapConfig.xml&quot;);</span><br><span class="line">        //2.创建构建者对象</span><br><span class="line">        SqlSessionFactoryBuilder builder = new SqlSessionFactoryBuilder();</span><br><span class="line">        //3.创建 SqlSession 工厂对象</span><br><span class="line">        factory = builder.build(in);</span><br><span class="line">        //4.创建 SqlSession 对象</span><br><span class="line">        session = factory.openSession();</span><br><span class="line">        //5.创建 Dao 的代理对象</span><br><span class="line">        userDao = session.getMapper(UserDao.class);</span><br><span class="line">    &#125;</span><br><span class="line">    @After//在测试方法执行完成之后执行</span><br><span class="line">    public void destroy() throws Exception&#123;</span><br><span class="line">        //7.释放资源</span><br><span class="line">        session.close();</span><br><span class="line">        in.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">     /**</span><br><span class="line">     * 测试根据id查询操作</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testFindOne() throws IOException &#123;</span><br><span class="line">        User user = userDao.findById(41);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3、保存操作"><a href="#3、保存操作" class="headerlink" title="3、保存操作"></a>3、保存操作</h3><h4 id="（1）在持久层接口中添加新增方法"><a href="#（1）在持久层接口中添加新增方法" class="headerlink" title="（1）在持久层接口中添加新增方法"></a>（1）在持久层接口中添加新增方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">* 保存用户</span><br><span class="line">* @param user</span><br><span class="line">* @return 影响数据库记录的行数</span><br><span class="line">*/</span><br><span class="line">int saveUser(User user);</span><br></pre></td></tr></table></figure>

<h4 id="（2）在用户的映射配置文件中配置-1"><a href="#（2）在用户的映射配置文件中配置-1" class="headerlink" title="（2）在用户的映射配置文件中配置"></a>（2）在用户的映射配置文件中配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 保存用户--&gt;</span><br><span class="line">&lt;insert id=&quot;saveUser&quot; parameterType=&quot;com.allen.domain.User&quot;&gt;</span><br><span class="line">    insert into user(username,birthday,sex,address) values(#&#123;username&#125;,#&#123;birthday&#125;,#&#123;sex&#125;,#&#123;address&#125;)</span><br><span class="line">&lt;/insert&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>#{}中内容的写法</strong>：<br>由于我们保存方法的<strong>参数是一个User对象</strong>，此处要写User<strong>对象中的属性名称</strong>。</li>
<li><em>它用的是 ognl 表达式。*</em></li>
<li><strong>ognl表达式</strong>：</li>
<li><em>它是apache提供的一种表达式语言*</em>，全称是：<strong>Object Graphic Navigation Language</strong> 对象图导航语言它是按照一定的语法格式来获取数据的。语法格式就是使用<code>#{对象.对象}</code>的方式</li>
<li><em>#{user.username}它会先去找 user 对象，然后在 user 对象中找到 username 属性，并调用<br>getUsername()方法把值取出来。但是我们在 parameterType 属性上指定了实体类名称，所以可以省略 user，而直接写username。</em></li>
</ul>
<h4 id="（3）添加测试类中的测试方法"><a href="#（3）添加测试类中的测试方法" class="headerlink" title="（3）添加测试类中的测试方法"></a>（3）添加测试类中的测试方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testSave()&#123;</span><br><span class="line">    User user = new User();</span><br><span class="line">    user.setUsername(&quot;modify User property&quot;);</span><br><span class="line">    user.setAddress(&quot;北京市顺义区&quot;);</span><br><span class="line">    user.setSex(&quot;男&quot;);</span><br><span class="line">    user.setBirthday(new Date());</span><br><span class="line">    System.out.println(&quot;保存操作之前：&quot;+user);</span><br><span class="line">    //5.执行保存方法</span><br><span class="line">    userDao.saveUser(user);</span><br><span class="line">    System.out.println(&quot;保存操作之后：&quot;+user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em>打开Mysql数据库发现并没有添加任何记录，原因是什么？</em></p>
<ul>
<li><strong>这一点和jdbc是一样的，我们在实现增删改时一定要去控制事务的提交</strong>，那么在<em>mybatis中如何控制事务提交呢？</em></li>
<li>可以使用:<code>session.commit();</code>来实现<strong>事务提交</strong>。加入事务提交后的代码如下：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@After//在测试方法执行完成之后执行</span><br><span class="line">public void destroy() throws Exception&#123;</span><br><span class="line">    session.commit();</span><br><span class="line">    //7.释放资源</span><br><span class="line">    session.close();</span><br><span class="line">    in.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="（4）问题扩展：新增用户id的返回值"><a href="#（4）问题扩展：新增用户id的返回值" class="headerlink" title="（4）问题扩展：新增用户id的返回值"></a>（4）问题扩展：新增用户id的返回值</h4><p>新增用户后，同时还要返回当前新增用户的id值，因为id是由数据库的自动增长来实现的，所以就相当于我们要<strong>在新增后将自动增长auto_increment的值返回</strong>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;insert id=&quot;saveUser&quot; parameterType=&quot;USER&quot;&gt;</span><br><span class="line">    &lt;!-- 配置保存时获取插入的 id --&gt;</span><br><span class="line">    &lt;selectKey keyColumn=&quot;id&quot; keyProperty=&quot;id&quot; resultType=&quot;int&quot;&gt;</span><br><span class="line">        select last_insert_id();</span><br><span class="line">    &lt;/selectKey&gt;</span><br><span class="line">    insert into user(username,birthday,sex,address) values(#&#123;username&#125;,#&#123;birthday&#125;,#&#123;sex&#125;,#&#123;address&#125;)</span><br><span class="line">&lt;/insert&gt;</span><br></pre></td></tr></table></figure>

<h3 id="4、用户更新"><a href="#4、用户更新" class="headerlink" title="4、用户更新"></a>4、用户更新</h3><h4 id="（1）在持久层接口中添加更新方法"><a href="#（1）在持久层接口中添加更新方法" class="headerlink" title="（1）在持久层接口中添加更新方法"></a>（1）在持久层接口中添加更新方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">* 更新用户</span><br><span class="line">* @param user</span><br><span class="line">* @return 影响数据库记录的行数</span><br><span class="line">*/</span><br><span class="line">int updateUser(User user);</span><br></pre></td></tr></table></figure>

<h4 id="（2）在用户的映射配置文件中配置-2"><a href="#（2）在用户的映射配置文件中配置-2" class="headerlink" title="（2）在用户的映射配置文件中配置"></a>（2）在用户的映射配置文件中配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 更新用户 --&gt;</span><br><span class="line">&lt;update id=&quot;updateUser&quot; parameterType=&quot;com.allen.domain.User&quot;&gt;</span><br><span class="line">    update user set username=#&#123;username&#125;,birthday=#&#123;birthday&#125;,sex=#&#123;sex&#125;,address=#&#123;address&#125; where id=#&#123;id&#125;</span><br><span class="line">&lt;/update&gt;</span><br></pre></td></tr></table></figure>

<h4 id="（3）加入更新的测试方法"><a href="#（3）加入更新的测试方法" class="headerlink" title="（3）加入更新的测试方法"></a>（3）加入更新的测试方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testUpdateUser()throws Exception&#123;</span><br><span class="line">    //1.根据 id 查询</span><br><span class="line">    User user = userDao.findById(52);</span><br><span class="line">    //2.更新操作</span><br><span class="line">    user.setAddress(&quot;北京市顺义区&quot;);</span><br><span class="line">    int res = userDao.updateUser(user);</span><br><span class="line">    System.out.println(res);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5、用户删除"><a href="#5、用户删除" class="headerlink" title="5、用户删除"></a>5、用户删除</h3><h4 id="（1）在持久层接口中添加删除方法"><a href="#（1）在持久层接口中添加删除方法" class="headerlink" title="（1）在持久层接口中添加删除方法"></a>（1）在持久层接口中添加删除方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">* 根据 id 删除用户</span><br><span class="line">* @param userId</span><br><span class="line">* @return</span><br><span class="line">*/</span><br><span class="line">int deleteUser(Integer userId);</span><br></pre></td></tr></table></figure>

<h4 id="（2）在用户的映射配置文件中配置-3"><a href="#（2）在用户的映射配置文件中配置-3" class="headerlink" title="（2）在用户的映射配置文件中配置"></a>（2）在用户的映射配置文件中配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 删除用户 --&gt;</span><br><span class="line">&lt;delete id=&quot;deleteUser&quot; parameterType=&quot;java.lang.Integer&quot;&gt;</span><br><span class="line">    delete from user where id = #&#123;uid&#125;</span><br><span class="line">&lt;/delete&gt;</span><br></pre></td></tr></table></figure>

<h4 id="（3）加入删除的测试方法"><a href="#（3）加入删除的测试方法" class="headerlink" title="（3）加入删除的测试方法"></a>（3）加入删除的测试方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testDeleteUser() throws Exception &#123;</span><br><span class="line">    //6.执行操作</span><br><span class="line">    int res = userDao.deleteUser(52);</span><br><span class="line">    System.out.println(res);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6、用户模糊查询"><a href="#6、用户模糊查询" class="headerlink" title="6、用户模糊查询"></a>6、用户模糊查询</h3><h4 id="（1）在持久层接口中添加模糊查询方法"><a href="#（1）在持久层接口中添加模糊查询方法" class="headerlink" title="（1）在持久层接口中添加模糊查询方法"></a>（1）在持久层接口中添加模糊查询方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">* 根据名称模糊查询</span><br><span class="line">* @param username</span><br><span class="line">* @return</span><br><span class="line">*/</span><br><span class="line">List&lt;User&gt; findByName(String username);</span><br></pre></td></tr></table></figure>

<h4 id="（2）在用户的映射配置文件中配置-4"><a href="#（2）在用户的映射配置文件中配置-4" class="headerlink" title="（2）在用户的映射配置文件中配置"></a>（2）在用户的映射配置文件中配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 根据名称模糊查询 --&gt;</span><br><span class="line">&lt;select id=&quot;findByName&quot; resultType=&quot;com.allen.domain.User&quot; parameterType=&quot;String&quot;&gt;</span><br><span class="line">    select * from user where username like #&#123;username&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<h4 id="（3）加入模糊查询的测试方法"><a href="#（3）加入模糊查询的测试方法" class="headerlink" title="（3）加入模糊查询的测试方法"></a>（3）加入模糊查询的测试方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testFindByName()&#123;</span><br><span class="line">    //5.执行查询一个方法</span><br><span class="line">    List&lt;User&gt; users = userDao.findByName(&quot;%王%&quot;);</span><br><span class="line">    for(User user : users)&#123;</span><br><span class="line">       System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><em>在控制台输出的执行SQL语句如下：</em><br><img src="/2020/03/12/初识Java持久层框架Mybatis之上/14.png" alt="image"><ul>
<li><strong>在配置文件中没有加入%来作为模糊查询的条件，所以在传入字符串实参时，就需要给定模糊查询的标识%。配置文件中的#{username}也只是一个占位符，所以 SQL 语句显示为“？”。</strong></li>
</ul>
</li>
</ul>
<h4 id="（4）模糊查询的另一种配置方式"><a href="#（4）模糊查询的另一种配置方式" class="headerlink" title="（4）模糊查询的另一种配置方式"></a>（4）模糊查询的另一种配置方式</h4><ul>
<li><strong>第一步：修改SQL语句的配置，配置如下：</strong><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 根据名称模糊查询 --&gt;</span><br><span class="line">&lt;select id=&quot;findByName&quot; parameterType=&quot;string&quot; resultType=&quot;com.allen.domain.User&quot;&gt;</span><br><span class="line">    select * from user where username like &apos;%$&#123;value&#125;%&apos;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><em>我们在上面将原来的<code>#{}</code>占位符，改成了<code>${value}</code>。注意如果用模糊查询的这种写法，那么<code>${value}</code>的写<br>法就是固定的，不能写成其它名字。</em></p>
<ul>
<li><p><strong>第二步：测试，</strong> 如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">* 测试模糊查询操作</span><br><span class="line"> */</span><br><span class="line">@Test</span><br><span class="line">public void testFindByName()&#123;</span><br><span class="line">    //5.执行查询一个方法</span><br><span class="line">    List&lt;User&gt; users = userDao.findByName(&quot;王&quot;);</span><br><span class="line">    for(User user : users)&#123;</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在控制台输出的执行 SQL 语句如下：<br><img src="/2020/03/12/初识Java持久层框架Mybatis之上/15.png" alt="image"></p>
<ul>
<li><em>可以发现，我们在程序代码中就不需要加入模糊查询的匹配符%了，这两种方式的实现效果是一样的，但执行的语句是不一样的。</em></li>
</ul>
</li>
</ul>
<h4 id="（5）-与-的区别"><a href="#（5）-与-的区别" class="headerlink" title="（5）#{}与${}的区别"></a>（5）#{}与${}的区别</h4><ul>
<li><strong>#{}表示一个占位符号</strong><ul>
<li>通过<code>#{}</code>可以实现preparedStatement向占位符中设置值，自动进行java类型和jdbc类型转换， <strong>#{}可以有效防止sql注入。</strong> #{}可以接收简单类型值或 pojo 属性值。 如果 parameterType 传输单个简单类型值，<code>#{}</code>括号中可以是 value 或其它名称。</li>
</ul>
</li>
<li><strong>${}表示拼接sql串</strong><ul>
<li>通过<code>${}</code>可以将parameterType传入的内容拼接在 sql 中且不进行jdbc类型转换， <code>${}</code>可以接收简单类型值或pojo属性值，如果parameterType传输单个简单类型值，<code>${}</code>括号中只能是 value。</li>
</ul>
</li>
</ul>
<h3 id="7、查询使用聚合函数"><a href="#7、查询使用聚合函数" class="headerlink" title="7、查询使用聚合函数"></a>7、查询使用聚合函数</h3><h4 id="（1）在持久层接口中添加模糊查询方法-1"><a href="#（1）在持久层接口中添加模糊查询方法-1" class="headerlink" title="（1）在持久层接口中添加模糊查询方法"></a>（1）在持久层接口中添加模糊查询方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">* 查询总记录条数</span><br><span class="line">* @return</span><br><span class="line">*/</span><br><span class="line">int findTotal();</span><br></pre></td></tr></table></figure>

<h4 id="（2）在用户的映射配置文件中配置-5"><a href="#（2）在用户的映射配置文件中配置-5" class="headerlink" title="（2）在用户的映射配置文件中配置"></a>（2）在用户的映射配置文件中配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 查询总记录条数 --&gt;</span><br><span class="line">&lt;select id=&quot;findTotal&quot; resultType=&quot;int&quot;&gt;</span><br><span class="line">    select count(*) from user;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<h4 id="（3）加入聚合查询的测试方法"><a href="#（3）加入聚合查询的测试方法" class="headerlink" title="（3）加入聚合查询的测试方法"></a>（3）加入聚合查询的测试方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testFindTotal() throws Exception &#123;</span><br><span class="line">    //6.执行操作</span><br><span class="line">    int res = userDao.findTotal();</span><br><span class="line">    System.out.println(res);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8、Mybatis与JDBC编程的比较"><a href="#8、Mybatis与JDBC编程的比较" class="headerlink" title="8、Mybatis与JDBC编程的比较"></a>8、Mybatis与JDBC编程的比较</h3><ul>
<li>数据库链接创建、释放频繁造成系统资源浪费从而影响系统性能，如果使用数据库链接池可解决此问题。<ul>
<li>解决：<strong>在 SqlMapConfig.xml 中配置数据链接池，使用连接池管理数据库链接。</strong></li>
</ul>
</li>
<li>Sql 语句写在代码中造成代码不易维护，实际应用 sql 变化的可能较大，sql 变动需要改变 java 代码。<ul>
<li>解决：<strong>将 Sql 语句配置在 XXXXmapper.xml 文件中与 java 代码分离。</strong></li>
</ul>
</li>
<li>向 sql 语句传参数麻烦，因为 sql 语句的 where 条件不一定，可能多也可能少，占位符需要和参数对应。<ul>
<li>解决：<strong>Mybatis 自动将 java 对象映射至 sql 语句，通过 statement 中的 parameterType 定义输入参数的类型。</strong></li>
</ul>
</li>
<li>对结果集解析麻烦，sql 变化导致解析代码变化，且解析前需要遍历，如果能将数据库记录封装成 pojo 对象解析比较方便。<ul>
<li>解决：<strong>Mybatis 自动将 sql 执行结果映射至 java 对象，通过 statement 中的 resultType 定义输出结果的类型。</strong></li>
</ul>
</li>
</ul>
<h2 id="五、Mybatis的参数深入"><a href="#五、Mybatis的参数深入" class="headerlink" title="五、Mybatis的参数深入"></a>五、Mybatis的参数深入</h2><h3 id="1、parameterType配置参数"><a href="#1、parameterType配置参数" class="headerlink" title="1、parameterType配置参数"></a>1、parameterType配置参数</h3><ul>
<li><strong>基本类型和String我们可以直接写类型名称，也可以使用包名.类名的方式</strong>，例如 ：<code>java.lang.String</code>。</li>
<li><strong>实体类类型，目前我们只能使用全限定类名。</strong></li>
<li>究其原因，<strong>是mybaits在加载时已经把常用的数据类型注册了别名</strong>，从而我们在使用时可以不写包名，而我们的是实体类并没有注册别名，所以必须写全限定类名。</li>
<li>在mybatis的官方文档的说明（如下图），<strong>这些都是支持的默认别名</strong><br><img src="/2020/03/12/初识Java持久层框架Mybatis之上/16.png" alt="image"></li>
</ul>
<h3 id="2、传递pojo包装对象"><a href="#2、传递pojo包装对象" class="headerlink" title="2、传递pojo包装对象"></a>2、传递pojo包装对象</h3><p><strong>开发中通过pojo传递查询条件</strong>，<strong>查询条件是综合的查询条件</strong>，不仅包括用户查询条件还包括其它的查询条件（比如将用户购买商品信息也作为查询条件），这时可以使用包装对象传递输入参数。</p>
<ul>
<li><strong>Pojo类中包含pojo。</strong></li>
<li><em>需求：根据用户名查询用户信息，查询条件放到QueryVo的user属性中。</em></li>
</ul>
<h4 id="（1）编写-QueryVo"><a href="#（1）编写-QueryVo" class="headerlink" title="（1）编写 QueryVo"></a>（1）编写 QueryVo</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">package com.allen.domain;</span><br><span class="line">public class QueryVo &#123;</span><br><span class="line">    private User user;</span><br><span class="line">    public User getUser() &#123;</span><br><span class="line">        return user;</span><br><span class="line">    &#125;</span><br><span class="line">    public void setUser(User user) &#123;</span><br><span class="line">        this.user = user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="（2）编写持久层接口"><a href="#（2）编写持久层接口" class="headerlink" title="（2）编写持久层接口"></a>（2）编写持久层接口</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">* 用户的业务层接口&lt;/p&gt;</span><br><span class="line">*/</span><br><span class="line">public interface UserDao &#123;</span><br><span class="line">    /**</span><br><span class="line">    * 根据 QueryVo 中的条件查询用户</span><br><span class="line">    * @param vo</span><br><span class="line">    * @return</span><br><span class="line">    */</span><br><span class="line">    List&lt;User&gt; findByVo(QueryVo vo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="（3）持久层接口的映射文件"><a href="#（3）持久层接口的映射文件" class="headerlink" title="（3）持久层接口的映射文件"></a>（3）持久层接口的映射文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 根据用户名称模糊查询，参数变成一个 QueryVo 对象了 --&gt;</span><br><span class="line">&lt;select id=&quot;findByVo&quot; resultType=&quot;com.allen.domain.User&quot; parameterType=&quot;com.allen.domain.QueryVo&quot;&gt;</span><br><span class="line">    select * from user where username like #&#123;user.username&#125;;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<h4 id="（4）测试包装类作为参数"><a href="#（4）测试包装类作为参数" class="headerlink" title="（4）测试包装类作为参数"></a>（4）测试包装类作为参数</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testFindByQueryVo() &#123;</span><br><span class="line">    QueryVo vo = new QueryVo();</span><br><span class="line">    User user = new User();</span><br><span class="line">    user.setUserName(&quot;%王%&quot;);</span><br><span class="line">    vo.setUser(user);</span><br><span class="line">    List&lt;User&gt; users = userDao.findByVo(vo);</span><br><span class="line">    for(User u : users) &#123;</span><br><span class="line">        System.out.println(u);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="六、Mybatis的输出结果封装"><a href="#六、Mybatis的输出结果封装" class="headerlink" title="六、Mybatis的输出结果封装"></a>六、Mybatis的输出结果封装</h2><h3 id="1、resultType配置结果类型"><a href="#1、resultType配置结果类型" class="headerlink" title="1、resultType配置结果类型"></a>1、resultType配置结果类型</h3><ul>
<li><strong>resultType属性可以指定结果集的类型，它支持基本类型和实体类类型。</strong></li>
<li><strong>它和parameterType一样，如果注册过类型别名的，可以直接使用别名。没有注册过的必须使用全限定类名</strong>。</li>
<li><strong>实体类中的属性名称必须和查询语句中的列名保持一致，否则无法实现封装。</strong></li>
</ul>
<h4 id="（1）基本类型示例"><a href="#（1）基本类型示例" class="headerlink" title="（1）基本类型示例"></a>（1）基本类型示例</h4><ul>
<li><p>Dao接口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">* 查询总记录条数</span><br><span class="line">* @return</span><br><span class="line">*/</span><br><span class="line">int findTotal();</span><br></pre></td></tr></table></figure>
</li>
<li><p>映射配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 查询总记录条数 --&gt;</span><br><span class="line">&lt;select id=&quot;findTotal&quot; resultType=&quot;int&quot;&gt;</span><br><span class="line">    select count(*) from user;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="（2）实体类类型示例"><a href="#（2）实体类类型示例" class="headerlink" title="（2）实体类类型示例"></a>（2）实体类类型示例</h4><ul>
<li><p>Dao接口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">* 查询所有用户</span><br><span class="line">* @return</span><br><span class="line">*/</span><br><span class="line">List&lt;User&gt; findAll();</span><br></pre></td></tr></table></figure>
</li>
<li><p>映射配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 配置查询所有操作 --&gt;</span><br><span class="line">&lt;select id=&quot;findAll&quot; resultType=&quot;com.allen.domain.User&quot;&gt;</span><br><span class="line">    select * from user</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="（3）特殊情况示例"><a href="#（3）特殊情况示例" class="headerlink" title="（3）特殊情况示例"></a>（3）特殊情况示例</h4><ul>
<li><p><strong>修改实体类</strong>，实体类代码如下：(<strong>此时的实体类属性和数据库表的列名已经不一致了</strong>)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">*用户的实体类</span><br><span class="line">*/</span><br><span class="line">public class User implements Serializable &#123;</span><br><span class="line">    private Integer userId;</span><br><span class="line">    private String userName;</span><br><span class="line">    private Date userBirthday;</span><br><span class="line">    private String userSex;</span><br><span class="line">    private String userAddress;</span><br><span class="line">    public Integer getUserId() &#123;</span><br><span class="line">        return userId;</span><br><span class="line">    &#125;</span><br><span class="line">    public void setUserId(Integer userId) &#123;</span><br><span class="line">        this.userId = userId;</span><br><span class="line">    &#125;</span><br><span class="line">    public String getUserName() &#123;</span><br><span class="line">        return userName;</span><br><span class="line">    &#125;</span><br><span class="line">    public void setUserName(String userName) &#123;</span><br><span class="line">        this.userName = userName;</span><br><span class="line">    &#125;</span><br><span class="line">    public Date getUserBirthday() &#123;</span><br><span class="line">        return userBirthday;</span><br><span class="line">    &#125;</span><br><span class="line">    public void setUserBirthday(Date userBirthday)&#123;</span><br><span class="line">        this.userBirthday = userBirthday;</span><br><span class="line">    &#125;</span><br><span class="line">    public String getUserSex() &#123;</span><br><span class="line">        return userSex;</span><br><span class="line">    &#125;</span><br><span class="line">    public void setUserSex(String userSex) &#123;</span><br><span class="line">        this.userSex = userSex;</span><br><span class="line">    &#125;</span><br><span class="line">    public String getUserAddress() &#123;</span><br><span class="line">        return userAddress;</span><br><span class="line">    &#125;</span><br><span class="line">    public void setUserAddress(String userAddress) &#123;</span><br><span class="line">        this.userAddress = userAddress;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;User [userId=&quot; + userId + &quot;, userName=&quot; + userName + &quot;, userBirthday=&quot;+ userBirthday + &quot;, userSex=&quot;+ userSex + &quot;, userAddress=&quot; + userAddress + &quot;]&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Dao 接口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">* 查询所有用户</span><br><span class="line">* @return</span><br><span class="line">*/</span><br><span class="line">List&lt;User&gt; findAll();</span><br></pre></td></tr></table></figure>
</li>
<li><p>映射配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 配置查询所有操作 --&gt;</span><br><span class="line">&lt;select id=&quot;findAll&quot; resultType=&quot;com.allen.domain.User&quot;&gt;</span><br><span class="line">    select * from user</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试查询结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testFindAll() &#123;</span><br><span class="line">    List&lt;User&gt; users = userDao.findAll();</span><br><span class="line">    for(User user : users) &#123;</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><img src="/2020/03/12/初识Java持久层框架Mybatis之上/17.png" alt="image"></p>
<ul>
<li><em>为什么名称会有值呢？</em><ul>
<li><strong>因为：mysql 在 windows 系统中不区分大小写！</strong></li>
</ul>
</li>
<li>修改映射配置(使用别名查询)<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 配置查询所有操作 --&gt;</span><br><span class="line">&lt;select id=&quot;findAll&quot; resultType=&quot;com.allen.domain.User&quot;&gt;</span><br><span class="line">    select id as userId,username as userName,birthday as userBirthday,sex as userSex,address as userAddress from user</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="2、resultMap结果类型"><a href="#2、resultMap结果类型" class="headerlink" title="2、resultMap结果类型"></a>2、resultMap结果类型</h3><ul>
<li><strong>resultMap标签可以建立查询的列名和实体类的属性名称不一致时建立对应关系。从而实现封装。</strong></li>
<li>在select 标签中使用resultMap属性指定引用即可。同时resultMap可以实现将查询结果映射为复杂类型的pojo，比如在查询结果映射对象中包括pojo和list实现一对一查询和一对多查询。</li>
</ul>
<h4 id="（1）定义-resultMap"><a href="#（1）定义-resultMap" class="headerlink" title="（1）定义 resultMap"></a>（1）定义 resultMap</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 建立 User 实体和数据库表的对应关系</span><br><span class="line">    type 属性：指定实体类的全限定类名</span><br><span class="line">    id 属性：给定一个唯一标识，是给查询 select 标签引用用的。</span><br><span class="line">--&gt;</span><br><span class="line">&lt;resultMap type=&quot;com.allen.domain.User&quot; id=&quot;userMap&quot;&gt;</span><br><span class="line">    &lt;id column=&quot;id&quot; property=&quot;userId&quot;/&gt;</span><br><span class="line">    &lt;result column=&quot;username&quot; property=&quot;userName&quot;/&gt;</span><br><span class="line">    &lt;result column=&quot;sex&quot; property=&quot;userSex&quot;/&gt;</span><br><span class="line">    &lt;result column=&quot;address&quot; property=&quot;userAddress&quot;/&gt;</span><br><span class="line">    &lt;result column=&quot;birthday&quot; property=&quot;userBirthday&quot;/&gt;</span><br><span class="line">&lt;/resultMap&gt;</span><br><span class="line">&lt;!--id 标签：用于指定主键字段</span><br><span class="line">result 标签：用于指定非主键字段</span><br><span class="line">column 属性：用于指定数据库列名</span><br><span class="line">property 属性：用于指定实体类属性名称</span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure>

<h4 id="（2）测试结果"><a href="#（2）测试结果" class="headerlink" title="（2）测试结果"></a>（2）测试结果</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testFindAll() &#123;</span><br><span class="line">    List&lt;User&gt; users = userDao.findAll();</span><br><span class="line">    for(User user : users) &#123;</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>运行结果：<br><img src="/2020/03/12/初识Java持久层框架Mybatis之上/18.png" alt="image"></li>
</ul>
<h2 id="七、Mybatis传统DAO层开发（了解）"><a href="#七、Mybatis传统DAO层开发（了解）" class="headerlink" title="七、Mybatis传统DAO层开发（了解）"></a>七、Mybatis传统DAO层开发（了解）</h2><p><strong>使用Mybatis开发Dao，通常有两个方法，即原始Dao开发方式和Mapper接口代理开发方式</strong>。而现在主流的开发方式是接口代理开发方式，这种方式总体上更加简便。现在介绍一下<strong>基于传统编写Dao实现类的开发方式</strong>。</p>
<h3 id="Mybatis-实现-DAO-的传统开发方式"><a href="#Mybatis-实现-DAO-的传统开发方式" class="headerlink" title="Mybatis 实现 DAO 的传统开发方式"></a>Mybatis 实现 DAO 的传统开发方式</h3><h4 id="（1）持久层-Dao-接口"><a href="#（1）持久层-Dao-接口" class="headerlink" title="（1）持久层 Dao 接口"></a>（1）持久层 Dao 接口</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">* 用户的业务层接口</span><br><span class="line">*/</span><br><span class="line">public interface UserDao &#123;</span><br><span class="line">    /**</span><br><span class="line">    * 查询所有用户</span><br><span class="line">    * @return</span><br><span class="line">    */</span><br><span class="line">    List&lt;User&gt; findAll();</span><br><span class="line">    /**</span><br><span class="line">    * 根据 id 查询</span><br><span class="line">    * @param userId</span><br><span class="line">    * @return</span><br><span class="line">    */</span><br><span class="line">    User findById(Integer userId);</span><br><span class="line">    /**</span><br><span class="line">    * 保存用户</span><br><span class="line">    * @param user</span><br><span class="line">    * @return 影响数据库记录的行数</span><br><span class="line">    */</span><br><span class="line">    int saveUser(User user);</span><br><span class="line">    /**</span><br><span class="line">    * 更新用户</span><br><span class="line">    * @param user</span><br><span class="line">    * @return 影响数据库记录的行数</span><br><span class="line">    */</span><br><span class="line">    int updateUser(User user);</span><br><span class="line">    /**</span><br><span class="line">    * 根据 id 删除用户</span><br><span class="line">    * @param userId</span><br><span class="line">    * @return</span><br><span class="line">    */</span><br><span class="line">    int deleteUser(Integer userId);</span><br><span class="line">    /**</span><br><span class="line">    * 查询总记录条数</span><br><span class="line">    * @return</span><br><span class="line">    */</span><br><span class="line">    int findTotal();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="（2）持久层-Dao-实现类"><a href="#（2）持久层-Dao-实现类" class="headerlink" title="（2）持久层 Dao 实现类"></a>（2）持久层 Dao 实现类</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">* dao的实现类</span><br><span class="line">*/</span><br><span class="line">public class UserDaoImpl implements UserDao &#123;</span><br><span class="line">    private SqlSessionFactory factory;</span><br><span class="line">    public UserDaoImpl(SqlSessionFactory factory) &#123;</span><br><span class="line">        this.factory = factory;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public List&lt;User&gt; findAll() &#123;</span><br><span class="line">        SqlSession session = factory.openSession();</span><br><span class="line">        List&lt;User&gt; users = session.selectList(&quot;com.allen.dao.UserDao.findAll&quot;);</span><br><span class="line">        session.close();</span><br><span class="line">        return users;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public User findById(Integer userId) &#123;</span><br><span class="line">        SqlSession session = factory.openSession();</span><br><span class="line">        User user = session.selectOne(&quot;com.allen.dao.UserDao.findById&quot;,userId);</span><br><span class="line">        session.close();</span><br><span class="line">        return user;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">        public int saveUser(User user) &#123;</span><br><span class="line">        SqlSession session = factory.openSession();</span><br><span class="line">        int res = session.insert(&quot;com.allen.dao.UserDao.saveUser&quot;,user);</span><br><span class="line">        session.commit();</span><br><span class="line">        session.close();</span><br><span class="line">        return res;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">        public int updateUser(User user) &#123;</span><br><span class="line">        SqlSession session = factory.openSession();</span><br><span class="line">        int res = session.update(&quot;com.allen.dao.UserDao.updateUser&quot;,user);</span><br><span class="line">        session.commit();</span><br><span class="line">        session.close();</span><br><span class="line">        return res;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">        public int deleteUser(Integer userId) &#123;</span><br><span class="line">        SqlSession session = factory.openSession();</span><br><span class="line">        int res = session.delete(&quot;com.allen.dao.UserDao.deleteUser&quot;,userId);</span><br><span class="line">        session.commit();</span><br><span class="line">        session.close();</span><br><span class="line">        return res;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">        public int findTotal() &#123;</span><br><span class="line">        SqlSession session = factory.openSession();</span><br><span class="line">        int res = session.selectOne(&quot;com.allen.dao.UserDao.findTotal&quot;);</span><br><span class="line">        session.close();</span><br><span class="line">        return res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="（3）持久层映射配置"><a href="#（3）持久层映射配置" class="headerlink" title="（3）持久层映射配置"></a>（3）持久层映射配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">        PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span><br><span class="line">        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line"> &lt;mapper namespace=&quot;com.allen.dao.UserDao&quot;&gt;</span><br><span class="line">    &lt;!--查询所有--&gt;</span><br><span class="line">    &lt;select id=&quot;findAll&quot; resultType=&quot;user&quot;&gt;</span><br><span class="line">        select * from user</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--保存用户--&gt;</span><br><span class="line">    &lt;insert id=&quot;saveUser&quot; parameterType=&quot;user&quot;&gt;</span><br><span class="line">        &lt;!--配置插入操作后，获得插入数据的id--&gt;</span><br><span class="line">        &lt;selectKey keyProperty=&quot;id&quot; keyColumn=&quot;id&quot; resultType=&quot;int&quot; order=&quot;AFTER&quot;&gt;</span><br><span class="line">            select LAST_insert_id();</span><br><span class="line">        &lt;/selectKey&gt;</span><br><span class="line">        insert into user(username,address,sex,birthday)values(#&#123;username&#125;,#&#123;address&#125;,#&#123;sex&#125;,#&#123;birthday&#125;);</span><br><span class="line">    &lt;/insert&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--更新用户--&gt;</span><br><span class="line">    &lt;update id=&quot;updateUser&quot; parameterType=&quot;user&quot;&gt;</span><br><span class="line">        update user set username=#&#123;username&#125;,address=#&#123;address&#125;,sex=#&#123;sex&#125;,birthday=#&#123;birthday&#125; where id=#&#123;id&#125; ;</span><br><span class="line">    &lt;/update&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--删除用户--&gt;</span><br><span class="line">    &lt;delete id=&quot;deleteUser&quot; parameterType=&quot;Integer&quot;&gt;</span><br><span class="line">        delete from user where id=#&#123;id&#125;;</span><br><span class="line">    &lt;/delete&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--根据id查询用户--&gt;</span><br><span class="line">    &lt;select id=&quot;findById&quot; resultType=&quot;user&quot; parameterType=&quot;INT&quot;&gt;</span><br><span class="line">        select * from user where id=#&#123;id&#125;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--根据名称模糊查询用户--&gt;</span><br><span class="line">    &lt;select id=&quot;findByName&quot; resultType=&quot;user&quot; parameterType=&quot;String&quot;&gt;</span><br><span class="line">      select * from user where username like #&#123;name&#125;</span><br><span class="line">      &lt;!--select * from user where username like &apos;%$&#123;value&#125;%&apos;--&gt;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--获取用户的总记录条数--&gt;</span><br><span class="line">    &lt;select id=&quot;findTotal&quot; resultType=&quot;int&quot;&gt;</span><br><span class="line">        select count(id) from user</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line"></span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure>

<h4 id="（4）测试类"><a href="#（4）测试类" class="headerlink" title="（4）测试类"></a>（4）测试类</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line">package com.allen.test;</span><br><span class="line"></span><br><span class="line">import com.allen.dao.UserDao;</span><br><span class="line">import com.allen.dao.impl.UserDaoImpl;</span><br><span class="line">import com.allen.domain.User;</span><br><span class="line">import org.apache.ibatis.io.Resources;</span><br><span class="line">import org.apache.ibatis.session.SqlSession;</span><br><span class="line">import org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line">import org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line">import org.junit.After;</span><br><span class="line">import org.junit.Before;</span><br><span class="line">import org.junit.Test;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.InputStream;</span><br><span class="line">import java.util.Date;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 测试Mybatis的crud操作</span><br><span class="line"> */</span><br><span class="line">public class MybatisTest &#123;</span><br><span class="line">    private InputStream in;</span><br><span class="line">    private UserDao userDao;</span><br><span class="line"></span><br><span class="line">    @Before</span><br><span class="line">    public void init() throws IOException&#123;</span><br><span class="line">        //1、读取配置文件生成字节输入流</span><br><span class="line">        in = Resources.getResourceAsStream(&quot;SqlMapConfig.xml&quot;);</span><br><span class="line">        //2、获取SqlSessionFactory</span><br><span class="line">        SqlSessionFactory factory = new SqlSessionFactoryBuilder().build(in);</span><br><span class="line">        //3、使用工厂对象，创建dao对象</span><br><span class="line">        userDao = new UserDaoImpl(factory);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @After</span><br><span class="line">    public void destory() throws IOException &#123;</span><br><span class="line">        //6、释放资源</span><br><span class="line">        in.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 测试查询所有</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testFindAll() &#123;</span><br><span class="line">        //5、执行查询所有方法</span><br><span class="line">        List&lt;User&gt; users = userDao.findAll();</span><br><span class="line">        for (User user : users) &#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 测试保存操作</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testSave() throws IOException &#123;</span><br><span class="line">        User user = new User();</span><br><span class="line">        user.setUsername(&quot;dao impl user&quot;);</span><br><span class="line">        user.setAddress(&quot;西安市&quot;);</span><br><span class="line">        user.setSex(&quot;男&quot;);</span><br><span class="line">        user.setBirthday(new Date());</span><br><span class="line">        System.out.println(&quot;保存操作之前：&quot;+user);</span><br><span class="line">        //5、执行保存方法</span><br><span class="line">        userDao.saveUser(user);</span><br><span class="line">        System.out.println(&quot;保存操作之后：&quot;+user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 测试更新操作</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testUpdate() throws IOException &#123;</span><br><span class="line">        User user = new User();</span><br><span class="line">        user.setId(50);</span><br><span class="line">        user.setUsername(&quot;userDaoImpl Update user&quot;);</span><br><span class="line">        user.setAddress(&quot;陕西省西安市&quot;);</span><br><span class="line">        user.setSex(&quot;女&quot;);</span><br><span class="line">        user.setBirthday(new Date());</span><br><span class="line"></span><br><span class="line">        userDao.updateUser(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 测试删除操作</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testDelete() throws IOException &#123;</span><br><span class="line"></span><br><span class="line">        userDao.deleteUser(49);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 测试根据id查询操作</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testFindOne() throws IOException &#123;</span><br><span class="line">        User user = userDao.findById(50);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 测试根据名字模糊查询操作</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testFindByName() throws IOException &#123;</span><br><span class="line">        List&lt;User&gt; users = userDao.findByName(&quot;%王%&quot;);</span><br><span class="line">        // List&lt;User&gt; users = userDao.findByName(&quot;王&quot;);</span><br><span class="line">        for (User user : users) &#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 测试查询总记录条数操作</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testFindTotal() throws IOException &#123;</span><br><span class="line">        int total = userDao.findTotal();</span><br><span class="line">        System.out.println(total);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="八、SqlMapConfig-xml配置文件"><a href="#八、SqlMapConfig-xml配置文件" class="headerlink" title="八、SqlMapConfig.xml配置文件"></a>八、SqlMapConfig.xml配置文件</h2><h3 id="1、配置内容"><a href="#1、配置内容" class="headerlink" title="1、配置内容"></a>1、配置内容</h3><h4 id="SqlMapConfig-xml中配置的内容和顺序"><a href="#SqlMapConfig-xml中配置的内容和顺序" class="headerlink" title="SqlMapConfig.xml中配置的内容和顺序"></a>SqlMapConfig.xml中配置的内容和顺序</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-properties（属性）</span><br><span class="line">    --property</span><br><span class="line">-settings（全局配置参数）</span><br><span class="line">    --setting</span><br><span class="line">-typeAliases（类型别名）</span><br><span class="line">    --typeAliase</span><br><span class="line">    --package</span><br><span class="line">-typeHandlers（类型处理器）</span><br><span class="line">-objectFactory（对象工厂）</span><br><span class="line">-plugins（插件）</span><br><span class="line">-environments（环境集合属性对象）</span><br><span class="line">    --environment（环境子属性对象）</span><br><span class="line">        ---transactionManager（事务管理）</span><br><span class="line">        ---dataSource（数据源）</span><br><span class="line">-mappers（映射器）</span><br><span class="line">    --mapper</span><br><span class="line">    --package</span><br></pre></td></tr></table></figure>

<h3 id="2、properties（属性）"><a href="#2、properties（属性）" class="headerlink" title="2、properties（属性）"></a>2、properties（属性）</h3><p><strong>在使用properties标签配置时，我们可以采用两种方式指定属性配置。</strong></p>
<h4 id="第一种"><a href="#第一种" class="headerlink" title="第一种"></a>第一种</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;properties&gt;</span><br><span class="line">    &lt;property name=&quot;jdbc.driver&quot; value=&quot;com.mysql.cj.jdbc.Driver&quot;/&gt;</span><br><span class="line">    &lt;property name=&quot;jdbc.url&quot; value=&quot;jdbc:mysql://localhost:3306/javatest?useSSL=false&amp;amp;serverTimezone=UTC&quot;/&gt;</span><br><span class="line">    &lt;property name=&quot;jdbc.username&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">    &lt;property name=&quot;jdbc.password&quot; value=&quot;991104&quot;/&gt;</span><br><span class="line">&lt;/properties&gt;</span><br></pre></td></tr></table></figure>

<h4 id="第二种"><a href="#第二种" class="headerlink" title="第二种"></a>第二种</h4><ul>
<li><p><strong>在classpath下定义jdbc.properties文件</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">jdbc.driver=com.mysql.cj.jdbc.Driver</span><br><span class="line">jdbc.url=jdbc:mysql://localhost:3306/javatest?useSSL=false&amp;serverTimezone=UTC</span><br><span class="line">jdbc.username=root</span><br><span class="line">jdbc.password=991104</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>标签配置，在SqlMapConfig.xml中</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--配置properties</span><br><span class="line">    可以在标签内部配置连接数据库的信息，也可以通过属性引用外部配置文件信息</span><br><span class="line">    resource属性：</span><br><span class="line">        用于指定配置文件的文件，是按照类路径的写法来写，并且必须存在于类路径下</span><br><span class="line">    url属性：</span><br><span class="line">        是要求按照Url的写法来写地址</span><br><span class="line">        URL：Uniform Resource Locator 统一资源定位符，它是可以唯一标识一个资源的位置</span><br><span class="line">        它的写法：</span><br><span class="line">            http://localhost:8080/mybatiesserver/demo1Servlet</span><br><span class="line">            协议      主机    端口        URI</span><br><span class="line">        URI：Uniform Resource Identified 统一资源标识符。它是在应用中可以唯一定位一个资源的。</span><br><span class="line">--&gt;</span><br><span class="line">&lt;properties resource=&quot;jdbcConfig.properties&quot;&gt;</span><br><span class="line">&lt;/properties&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>此时dataSource标签就变成了引用上面的配置</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;property name=&quot;driver&quot; value=&quot;$&#123;jdbc.driver&#125;&quot;&gt;&lt;/property&gt;</span><br><span class="line">&lt;property name=&quot;url&quot; value=&quot;$&#123;jdbc.url&#125;&quot;&gt;&lt;/property&gt;</span><br><span class="line">&lt;property name=&quot;username&quot; value=&quot;$&#123;jdbc.username&#125;&quot;&gt;&lt;/property&gt;</span><br><span class="line">&lt;property name=&quot;password&quot; value=&quot;$&#123;jdbc.password&#125;&quot;&gt;&lt;/property&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="3、typeAliases（类型别名）"><a href="#3、typeAliases（类型别名）" class="headerlink" title="3、typeAliases（类型别名）"></a>3、typeAliases（类型别名）</h3><p><em>Mybatis支持的默认别名，也可以采用自定义别名方式来开发。</em></p>
<h4 id="（1）自定义别名"><a href="#（1）自定义别名" class="headerlink" title="（1）自定义别名"></a>（1）自定义别名</h4><ul>
<li><strong>在SqlMapConfig.xml中配置：</strong><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;typeAliases&gt;</span><br><span class="line">&lt;!-- 单个别名定义 --&gt;</span><br><span class="line">&lt;typeAlias alias=&quot;user&quot; type=&quot;com.allen.domain.User&quot;/&gt;</span><br><span class="line">    &lt;!-- 批量别名定义，扫描整个包下的类，别名为类名（首字母大写或小写都可以） --&gt;</span><br><span class="line">    &lt;package name=&quot;com.allen.domain&quot;/&gt;</span><br><span class="line">    &lt;package name=&quot;其它包&quot;/&gt;</span><br><span class="line">&lt;/typeAliases&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="4、mappers（映射器）"><a href="#4、mappers（映射器）" class="headerlink" title="4、mappers（映射器）"></a>4、mappers（映射器）</h3><ul>
<li><code>&lt;mapper resource=&quot; &quot; /&gt;</code><strong>使用相对于类路径的资源</strong><ul>
<li>如：<code>&lt;mapper resource=&quot;com/allen/dao/UserDao.xml&quot; /&gt;</code></li>
</ul>
</li>
<li><code>&lt;mapper class=&quot; &quot; /&gt;</code><strong>使用 mapper 接口类路径</strong><ul>
<li>如：<code>&lt;mapper class=&quot;com.allen.dao.UserDao&quot;/&gt;</code></li>
<li><strong>注意：此种方法要求mapper接口名称和mapper映射文件名称相同，且放在同一个目录中。</strong></li>
</ul>
</li>
<li><code>&lt;package name=&quot;&quot;/&gt;**</code>注册指定包下的所有 mapper 接口**<ul>
<li>如：<code>&lt;package name=&quot;con.allen.mybatis.mapper&quot;/&gt;</code></li>
<li><strong>注意：此种方法要求mapper接口名称和mapper映射文件名称相同，且放在同一个目录中。</strong></li>
</ul>
</li>
</ul>
<h2 id="三张非常重要的图（对Mybatis的深入了解）"><a href="#三张非常重要的图（对Mybatis的深入了解）" class="headerlink" title="三张非常重要的图（对Mybatis的深入了解）"></a>三张非常重要的图（对Mybatis的深入了解）</h2><p><img src="/2020/03/12/初识Java持久层框架Mybatis之上/19.png" alt="image"></p>
<ul>
<li><strong>分析编写dao实现类Mybatis的执行过程</strong><br><img src="/2020/03/12/初识Java持久层框架Mybatis之上/20.png" alt="image"></li>
<li><strong>分析代理dao的执行过程</strong><br><img src="/2020/03/12/初识Java持久层框架Mybatis之上/21.png" alt="image"></li>
</ul>
<h2 id="备注："><a href="#备注：" class="headerlink" title="备注："></a>备注：</h2><p><em>内容很充足，过两天更新下集</em></p>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>Allen Xue</span>
                    </p>
                
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2019 <a href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                
                     <p class="copyright-item">
                         <span>Slogan:</span>
                         <span><strong>To be or not to be,that is a question.<strong></strong></strong></span>
                     </p>
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tag/Java-EE/"># Java_EE</a>
                    
                        <a href="/tag/Mybatis/"># Mybatis</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2020/03/13/初识Java持久层框架Mybatis之下（连接池、缓存和注解开发）/">初识Java持久层框架Mybatis之下（连接池、缓存和注解开发）</a>
            
            
            <a class="next" rel="next" href="/2020/03/09/Linux中搭建Nginx助Web项目一臂之力/">Linux中搭建Nginx助Web项目一臂之力</a>
            
        </section>


    </article>
</div>

        </div>
        <footer id="footer" class="footer">
    <div class="copyright">
        <span>© Allen Xue | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
    
        <script type="text/javascript" color="0,0,0" opacity="0.3" zindex="-2" count="99" src="/js/canvas-nest.js"></script>
    
</body>
</html>
